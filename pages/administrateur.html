<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Franchini</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Styles généraux */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Admin */
        .admin-header {
            background-color: #4CAF50;
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        .admin-header .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .admin-header .user-name {
            font-weight: 500;
        }

        .admin-header .logout-btn {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
        }

        .admin-header .logout-btn i {
            margin-right: 0.5rem;
        }

        .admin-header .logout-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }

        /* Styles pour le logo et la navigation */
        .main-header {
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-text {
            font-family: Arial, sans-serif;
            font-size: 32px;
            font-weight: bold;
            color: #333;
            letter-spacing: 1px;
            position: relative;
            text-decoration: none;
        }

        .logo-text::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%) scaleX(0.7);
            width: 100%;
            height: 3px;
            background-color: #4CAF50;
        }

        .header-social {
            display: flex;
            gap: 15px;
            margin-left: 20px;
        }

        .header-social .social-icon {
            color: #888;
            font-size: 20px;
            transition: color 0.3s;
            opacity: 0.7;
        }

        .header-social .social-icon:hover {
            color: #3D6AA2;
            opacity: 1;
        }

        .main-nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
            margin: 0;
            padding: 0;
        }

        .main-nav a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 0;
            position: relative;
        }

        .main-nav a:hover {
            color: #4CAF50;
        }

        .phone-number {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #333;
            text-decoration: none;
            font-weight: 500;
        }

        .phone-number i {
            color: #4CAF50;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            color: #4CAF50;
        }

        .tab-btn.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        .tab-btn i {
            margin-right: 0.5rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cards */
        .admin-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card h2 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: #333;
            font-size: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.8rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: #4CAF50;
            outline: none;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #388e3c;
        }

        .btn-secondary {
            background-color: #757575;
        }

        .btn-secondary:hover {
            background-color: #616161;
        }

        .btn-danger {
            background-color: #f44336;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        /* Tables */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .admin-table th {
            font-weight: 500;
            color: #555;
            background-color: #f9f9f9;
        }

        .admin-table tr:hover {
            background-color: #f5f5f5;
        }

        .action-btns {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background-color: #eee;
            color: #333;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background-color: #ddd;
        }

        .action-btn.edit:hover {
            background-color: #4CAF50;
            color: white;
        }

        .action-btn.delete:hover {
            background-color: #f44336;
            color: white;
        }

        /* Dropzone */
        .dropzone {
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }
        
        .dropzone:hover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
        }

        .dropzone.dragover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }

        .dropzone i {
            font-size: 2rem;
            color: #888;
            margin-bottom: 10px;
        }

        /* Styles pour les vignettes d'aperçu */
        .thumbnail-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .thumbnail {
            width: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .thumbnail img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        .thumbnail-name {
            font-size: 0.7rem;
            padding: 3px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
        }

        /* Styles pour les formulaires de location */
        #tracteur-location-details,
        #materiel-location-details {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        /* Styles pour les radios et checkboxes */
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-label input {
            margin-right: 5px;
        }

        /* Déjà défini plus haut */

        .dropzone i {
            font-size: 2rem;
            color: #4CAF50;
            margin-bottom: 1rem;
        }
        
        /* Styles pour le carrousel d'accueil */
        .carousel-items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .carousel-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .carousel-item-preview {
            position: relative;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: #f5f5f5;
            overflow: hidden;
        }
        
        .carousel-item-preview img,
        .carousel-item-preview iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .carousel-item-details {
            padding: 15px;
        }
        
        .carousel-item-details h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .carousel-item-details p {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 0.9em;
        }
        
        .carousel-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }
        
        .carousel-item-link {
            color: #4CAF50;
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .carousel-item-link:hover {
            text-decoration: underline;
        }
        
        /* Styles pour le glisser-déposer */
        .carousel-item {
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .carousel-item.dragging {
            opacity: 0.5;
            transform: scale(0.98);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .carousel-item.drag-over {
            border: 2px dashed #4CAF50;
            border-radius: 4px;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .carousel-items-container.drag-over-container {
            background-color: rgba(76, 175, 80, 0.05);
            border: 2px dashed #4CAF50;
            border-radius: 4px;
            min-height: 100px;
            transition: all 0.2s;
        }
        
        .drag-handle {
            cursor: move;
            padding: 5px;
            color: #666;
            transition: color 0.2s;
        }
        
        .drag-handle:hover {
            color: #4CAF50;
        }
        
        .carousel-item-buttons button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1em;
        }
        
        .carousel-item-buttons button:hover {
            color: #e74c3c;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn i {
            margin-right: 0.5rem;
        }
        
        .btn:hover {
            background-color: #45a049;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .preview-container {
            margin-top: 1rem;
        }
        
        .preview-container img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            margin-top: 0.5rem;
        }

        .dropzone p {
            margin: 0;
            color: #666;
        }

        .thumbnail-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* Radio & Checkbox */
        .radio-group {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-label input {
            margin-right: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <a href="../index.html" class="logo-link">
                    <div class="logo-text">FRANCHINI</div>
                </a>
                <div class="header-social">
                    <a href="https://www.facebook.com/franchinimarches" target="_blank" class="social-icon">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://www.instagram.com/franchini_deutzfahr" target="_blank" class="social-icon">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li class="dropdown">
                        <a href="concession.html">La concession</a>
                    </li>
                    <li class="dropdown">
                        <a href="#">Matériel neuf</a>
                        <div class="dropdown-content">
                            <a href="materiel.html">Matériel neuf</a>
                            <a href="materiel-disponible.html">Matériel neuf disponible</a>
                        </div>
                    </li>
                    <li><a href="location.html">Location</a></li>
                    <li><a href="https://www.agriaffaires.com/pros/list/22624-0/1/franchini-sarl.html" target="_blank">Occasion</a></li>
                    <li><a href="magasin.html">Magasin</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="tel:0475474037" class="phone-number"><i class="fas fa-phone"></i> 04 75 47 40 37</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="admin-header">
        <div class="container">
            <div class="user-info">
                <h1>Panneau d'administration</h1>
                <div>
                    <span class="user-name">Connecté en tant que Cedric</span>
                    <a href="connexion-prive.html" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </div>

    <main class="container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="accueil">
                    <i class="fas fa-home"></i> Page d'accueil
                </button>
                <a href="https://supabase.com/dashboard/project/svvupcjjqyyehxbxlkro/auth/users?f={\"search_query\":\"1b13f9b9-a4ab-47da-b29b-9839b126f69b\"}" target="_blank" class="tab-btn" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-users"></i> Gérer les utilisateurs (Supabase)
                </a>
                <button class="tab-btn" data-tab="actualites">
                    <i class="fas fa-newspaper"></i> Actualités
                </button>
                <button class="tab-btn" data-tab="occasions">
                    <i class="fas fa-car"></i> Occasions
                </button>
                <button class="tab-btn" data-tab="promotions">
                    <i class="fas fa-tags"></i> Promotions
                </button>
                <button class="tab-btn" data-tab="contacts">
                    <i class="fas fa-address-book"></i> Contacts
                </button>
            </div>

            <div id="accueil" class="tab-content active">
                <h2>Personnalisation du bandeau d'accueil</h2>
                <div class="admin-card">
                    <h3>Gestion du carrousel</h3>
                    <div class="form-group">
                        <label for="media-type">Type de média :</label>
                        <select id="media-type" class="form-control">
                            <option value="image">Image</option>
                            <option value="youtube">Vidéo YouTube</option>
                        </select>
                    </div>
                    
                    <div id="image-upload-section">
                        <div class="form-group">
                            <label for="media-upload">Téléverser une image :</label>
                            <div class="dropzone" id="media-dropzone">
                                <p>Glissez-déposez une image ici ou cliquez pour sélectionner</p>
                                <input type="file" id="media-upload" accept="image/*" style="display: none;">
                            </div>
                            <div id="media-preview" class="preview-container"></div>
                        </div>
                    </div>
                    
                    <div id="youtube-section" style="display: none;">
                        <div class="form-group">
                            <label for="youtube-url">URL de la vidéo YouTube :</label>
                            <input type="text" id="youtube-url" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="media-title">Titre (optionnel) :</label>
                        <input type="text" id="media-title" class="form-control" placeholder="Titre du média">
                    </div>
                    
                    <div class="form-group">
                        <label for="media-description">Description (optionnel) :</label>
                        <textarea id="media-description" class="form-control" rows="3" placeholder="Description du média"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="media-link">Lien (optionnel) :</label>
                        <input type="url" id="media-link" class="form-control" placeholder="https://exemple.com">
                        <label for="link-text">Texte du lien :</label>
                        <input type="text" id="link-text" class="form-control" placeholder="Voir plus">
                    </div>
                    
                    <button type="button" id="add-media-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ajouter au carrousel
                    </button>
                </div>
                
                <div class="admin-card">
                    <h3>Éléments du carrousel</h3>
                    <div id="carousel-items" class="carousel-items-container">
                        <!-- Les éléments du carrousel seront ajoutés ici dynamiquement -->
                    </div>
                </div>
            </div>
            
            <div id="actualites" class="tab-content">
                <h2>Gestion des Actualités</h2>
                <div class="admin-card">
                    <h3>Ajouter/Modifier une Actualité</h3>
                    <form id="actualite-form">
                        <label for="actualite-titre">Titre:</label><input type="text" id="actualite-titre" required><br>
                        <label for="actualite-contenu">Contenu:</label><textarea id="actualite-contenu" rows="5" required></textarea><br>
                        <label for="actualite-date">Date:</label><input type="date" id="actualite-date" required><br>
                        <!-- Pour l'image, une gestion plus complexe serait nécessaire (upload, etc.). Pour l'instant, on omet. -->
                        <button type="button" id="add-actualite-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter l'actualité</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Actualités</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Titre</th><th>Date</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="actualites-table-body">
                            <!-- Les actualités seront listées ici -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="occasions" class="tab-content">
                <h2>Gestion des Occasions (Matériels et Tracteurs)</h2>
                <div class="admin-card">
                    <h3>Ajouter/Modifier un Matériel/Tracteur</h3>
                    <form id="materiel-type-selector">
                        <label><input type="radio" name="materiel-categorie" value="tracteur" checked> Tracteur</label>
                        <label><input type="radio" name="materiel-categorie" value="materiel"> Autre Matériel</label>
                    </form>
                    <form id="tracteur-form" style="display: block;">
                        <h4>Formulaire Tracteur</h4>
                        <label for="tracteur-marque">Marque:</label><input type="text" id="tracteur-marque"><br>
                        <label for="tracteur-modele">Modèle:</label><input type="text" id="tracteur-modele"><br>
                        <label for="tracteur-puissance">Puissance (ch):</label><input type="number" id="tracteur-puissance"><br>
                        <label for="tracteur-boite">Boîte de vitesses:</label><input type="text" id="tracteur-boite"><br>
                        <label for="tracteur-pneus-av">Pneus AV:</label><input type="text" id="tracteur-pneus-av"><br>
                        <label for="tracteur-pneus-ar">Pneus AR:</label><input type="text" id="tracteur-pneus-ar"><br>
                        <label for="tracteur-prix">Prix (€):</label><input type="number" id="tracteur-prix"><br>
                        <label>État:</label>
                        <label><input type="radio" name="materiel-etat" value="neuf" checked> Neuf</label>
                        <label><input type="radio" name="materiel-etat" value="occasion"> Occasion</label><br>
                        <label><input type="checkbox" id="tracteur-location"> Proposer à la location</label>
                        <div id="tracteur-location-details" style="display:none;">
                            <label for="tracteur-prix-jour">Prix/Jour (€):</label><input type="number" id="tracteur-prix-jour"><br>
                            <label for="tracteur-prix-semaine">Prix/Semaine (€):</label><input type="number" id="tracteur-prix-semaine"><br>
                        </div>
                        <label for="tracteur-photos">Photos:</label>
                        <div id="tracteur-dropzone" class="dropzone"><p>Glissez-déposez des photos ici ou cliquez pour sélectionner.</p></div>
                        <input type="file" id="tracteur-photos" multiple accept="image/*" style="display:none;">
                        <div id="tracteur-preview" class="preview-container"></div>
                        <button type="button" id="add-tracteur-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter le tracteur</button>
                    </form>
                    <form id="materiel-form" style="display: none;">
                        <h4>Formulaire Autre Matériel</h4>
                        <label for="materiel-type">Type de matériel:</label><input type="text" id="materiel-type"><br>
                        <label for="materiel-marque">Marque:</label><input type="text" id="materiel-marque"><br>
                        <label for="materiel-prix">Prix (€):</label><input type="number" id="materiel-prix"><br>
                        <label>État:</label>
                        <label><input type="radio" name="materiel-etat-autre" value="neuf" checked> Neuf</label>
                        <label><input type="radio" name="materiel-etat-autre" value="occasion"> Occasion</label><br>
                        <label><input type="checkbox" id="materiel-location"> Proposer à la location</label>
                        <div id="materiel-location-details" style="display:none;">
                            <label for="materiel-prix-jour">Prix/Jour (€):</label><input type="number" id="materiel-prix-jour"><br>
                            <label for="materiel-prix-semaine">Prix/Semaine (€):</label><input type="number" id="materiel-prix-semaine"><br>
                        </div>
                        <label for="materiel-photos">Photos:</label>
                        <div id="materiel-dropzone" class="dropzone"><p>Glissez-déposez des photos ici ou cliquez pour sélectionner.</p></div>
                        <input type="file" id="materiel-photos" multiple accept="image/*" style="display:none;">
                        <div id="materiel-preview" class="preview-container"></div>
                        <button type="button" id="add-materiel-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter le matériel</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Occasions</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Type</th><th>Marque</th><th>Modèle/Type</th><th>État</th><th>Prix</th><th>Location</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="occasions-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="promotions" class="tab-content">
                <h2>Gestion des Promotions</h2>
                 <div class="admin-card">
                     <h3>Ajouter/Modifier une Promotion</h3>
                     <form id="promo-form">
                        <label for="promo-title">Titre:</label><input type="text" id="promo-title" required><br>
                        <label for="promo-description">Description:</label><textarea id="promo-description"></textarea><br>
                        <label for="promo-date-debut">Date de début:</label><input type="date" id="promo-date-debut" required><br>
                        <label for="promo-date-fin">Date de fin:</label><input type="date" id="promo-date-fin" required><br>
                        <label for="promo-image">Image:</label>
                        <div id="promo-dropzone" class="dropzone"><p>Glissez-déposez une image ici ou cliquez pour sélectionner.</p></div>
                        <input type="file" id="promo-image" accept="image/*" style="display:none;">
                        <div id="promo-preview" class="preview-container"></div>
                        <button type="button" id="add-promo-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter la promotion</button>
                     </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Promotions</h3>
                    <table class="admin-table">
                        <thead><tr><th>Titre</th><th>Période</th><th>Actions</th></tr></thead>
                        <tbody id="promos-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="contacts" class="tab-content">
                <h2>Gestion des Fiches Contact</h2>
                 <div class="admin-card">
                    <h3>Ajouter/Modifier un Contact</h3>
                    <form id="contact-form">
                        <label for="contact-service">Service:</label>
                        <select id="contact-service" required>
                            <option value="direction">Direction</option><option value="commercial">Commercial</option><option value="atelier">Atelier</option><option value="magasin">Magasin</option><option value="secretariat">Secrétariat</option>
                        </select><br>
                        <label for="contact-nom">Nom:</label><input type="text" id="contact-nom" required><br>
                        <label for="contact-prenom">Prénom:</label><input type="text" id="contact-prenom" required><br>
                        <label for="contact-fonction">Fonction:</label><input type="text" id="contact-fonction" required><br>
                        <label for="contact-tel">Téléphone:</label><input type="tel" id="contact-tel"><br>
                        <label for="contact-email">Email:</label><input type="email" id="contact-email"><br>
                        <button type="button" id="add-contact-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter le contact</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Contacts</h3>
                    <table class="admin-table">
                        <thead><tr><th>Service</th><th>Nom Prénom</th><th>Fonction</th><th>Actions</th></tr></thead>
                        <tbody id="contacts-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    <script>
        // Stockage des données
        const materiels = JSON.parse(localStorage.getItem('franchiniOccasions')) || [];
        let currentEditId = null;

        const actualites = JSON.parse(localStorage.getItem('franchiniActualites')) || [];
        let currentActualiteEditId = null;

        // Gestion des onglets
        document.addEventListener('DOMContentLoaded', function() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                // Si c'est un lien externe, on ne fait rien de plus
                if (btn.tagName === 'A') return;
                
                btn.addEventListener('click', () => {
                    // Désactiver tous les onglets
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Activer l'onglet cliqué
                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Activer le premier onglet par défaut (en sautant le lien externe)
            const firstTab = document.querySelector('.tab-btn:not([href])');
            if (firstTab) {
                firstTab.click();
            }

            // Gestion des occasions (tracteurs et matériels)
            const materielTypeRadios = document.querySelectorAll('input[name="materiel-categorie"]');
            const tracteurForm = document.getElementById('tracteur-form');
            const materielForm = document.getElementById('materiel-form');
            
            // Gestion de l'affichage des formulaires de matériel/tracteur
            materielTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    tracteurForm.style.display = this.value === 'tracteur' ? 'block' : 'none';
                    materielForm.style.display = this.value === 'materiel' ? 'block' : 'none';
                });
            });

            // Gestion de la location pour les tracteurs
            document.getElementById('tracteur-location').addEventListener('change', function() {
                document.getElementById('tracteur-location-details').style.display = this.checked ? 'block' : 'none';
            });

            // Gestion de la location pour le matériel
            document.getElementById('materiel-location').addEventListener('change', function() {
                document.getElementById('materiel-location-details').style.display = this.checked ? 'block' : 'none';
            });

            // Gestion de l'ajout d'un tracteur
            document.getElementById('add-tracteur-btn').addEventListener('click', function() {
                const etat = document.querySelector('input[name="materiel-etat"]:checked').value;
                const location = document.getElementById('tracteur-location').checked;
                
                const materiel = {
                    id: Date.now(),
                    type: 'tracteur',
                    etat: etat,
                    marque: document.getElementById('tracteur-marque').value,
                    modele: document.getElementById('tracteur-modele').value,
                    puissance: document.getElementById('tracteur-puissance').value,
                    boite: document.getElementById('tracteur-boite').value,
                    pneusAv: document.getElementById('tracteur-pneus-av').value,
                    pneusAr: document.getElementById('tracteur-pneus-ar').value,
                    prix: document.getElementById('tracteur-prix').value,
                    location: location,
                    prixJour: location ? document.getElementById('tracteur-prix-jour').value : null,
                    prixSemaine: location ? document.getElementById('tracteur-prix-semaine').value : null,
                    photos: [] // À implémenter: gestion des photos
                };

                if (currentEditId) {
                    // Mise à jour d'un matériel existant
                    const index = materiels.findIndex(m => m.id === currentEditId);
                    if (index !== -1) {
                        materiels[index] = { ...materiel, id: currentEditId };
                    }
                    currentEditId = null;
                    this.innerHTML = '<i class="fas fa-plus"></i> Ajouter le tracteur';
                } else {
                    // Ajout d'un nouveau matériel
                    materiels.push(materiel);
                }

                updateMaterielsTable();
                resetTracteurForm();
            });

            // Gestion de l'ajout d'un matériel
            document.getElementById('add-materiel-btn').addEventListener('click', function() {
                const etat = document.querySelector('input[name="materiel-etat-autre"]:checked').value; // Changed name here to avoid conflict
                const location = document.getElementById('materiel-location').checked;
                
                const materiel = {
                    id: Date.now(),
                    type: 'materiel',
                    etat: etat,
                    typeMateriel: document.getElementById('materiel-type').value,
                    marque: document.getElementById('materiel-marque').value,
                    prix: document.getElementById('materiel-prix').value,
                    location: location,
                    prixJour: location ? document.getElementById('materiel-prix-jour').value : null,
                    prixSemaine: location ? document.getElementById('materiel-prix-semaine').value : null,
                    photos: [] // À implémenter: gestion des photos
                };

                if (currentEditId) {
                    // Mise à jour d'un matériel existant
                    const index = materiels.findIndex(m => m.id === currentEditId);
                    if (index !== -1) {
                        materiels[index] = { ...materiel, id: currentEditId };
                    }
                    currentEditId = null;
                    this.innerHTML = '<i class="fas fa-plus"></i> Ajouter le matériel';
                } else {
                    // Ajout d'un nouveau matériel
                    materiels.push(materiel);
                }

                updateMaterielsTable();
                resetMaterielForm();
            });

            // Fonction pour mettre à jour le tableau des matériels
            function updateMaterielsTable() {
                const tbody = document.getElementById('occasions-table-body');
                tbody.innerHTML = '';

                materiels.forEach(materiel => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${materiel.type === 'tracteur' ? 'Tracteur' : 'Matériel'}</td>
                        <td>${materiel.marque}</td>
                        <td>${materiel.type === 'tracteur' ? materiel.modele : materiel.typeMateriel}</td>
                        <td>${materiel.etat.charAt(0).toUpperCase() + materiel.etat.slice(1)}</td>
                        <td>${materiel.prix} €</td>
                        <td>${materiel.location ? 'Oui' : 'Non'}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${materiel.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Supprimer" data-id="${materiel.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Ajout des écouteurs d'événements pour les boutons d'action
                document.querySelectorAll('#occasions-table-body .action-btn.edit').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editMateriel(id);
                    });
                });

                document.querySelectorAll('#occasions-table-body .action-btn.delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteMateriel(id);
                    });
                });

                // Mise à jour des pages concernées (simulé pour l'instant)
                // updateMaterielDisponiblePage(); 
                // updateOccasionPage();
                // updateLocationPage();
                localStorage.setItem('franchiniOccasions', JSON.stringify(materiels));
            }

            // Fonction pour éditer un matériel
            function editMateriel(id) {
                const materiel = materiels.find(m => m.id === id);
                if (!materiel) return;

                currentEditId = id;

                document.querySelector(`input[name="materiel-categorie"][value="${materiel.type}"]`).checked = true;
                tracteurForm.style.display = materiel.type === 'tracteur' ? 'block' : 'none';
                materielForm.style.display = materiel.type === 'materiel' ? 'block' : 'none';

                if (materiel.type === 'tracteur') {
                    document.querySelector('input[name="materiel-etat"]:checked').value = materiel.etat;
                    document.getElementById('tracteur-marque').value = materiel.marque || '';
                    document.getElementById('tracteur-modele').value = materiel.modele || '';
                    document.getElementById('tracteur-puissance').value = materiel.puissance || '';
                    document.getElementById('tracteur-boite').value = materiel.boite || '';
                    document.getElementById('tracteur-pneus-av').value = materiel.pneusAv || '';
                    document.getElementById('tracteur-pneus-ar').value = materiel.pneusAr || '';
                    document.getElementById('tracteur-prix').value = materiel.prix || '';
                    document.getElementById('tracteur-location').checked = materiel.location || false;
                    document.getElementById('tracteur-location-details').style.display = materiel.location ? 'block' : 'none';
                    document.getElementById('tracteur-prix-jour').value = materiel.prixJour || '';
                    document.getElementById('tracteur-prix-semaine').value = materiel.prixSemaine || '';
                    document.getElementById('add-tracteur-btn').innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                } else {
                    document.querySelector('input[name="materiel-etat-autre"]:checked').value = materiel.etat;
                    document.getElementById('materiel-type').value = materiel.typeMateriel || '';
                    document.getElementById('materiel-marque').value = materiel.marque || '';
                    document.getElementById('materiel-prix').value = materiel.prix || '';
                    document.getElementById('materiel-location').checked = materiel.location || false;
                    document.getElementById('materiel-location-details').style.display = materiel.location ? 'block' : 'none';
                    document.getElementById('materiel-prix-jour').value = materiel.prixJour || '';
                    document.getElementById('materiel-prix-semaine').value = materiel.prixSemaine || '';
                    document.getElementById('add-materiel-btn').innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                }
                document.querySelector('#occasions .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deleteMateriel(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer ce matériel ?')) {
                    const index = materiels.findIndex(m => m.id === id);
                    if (index !== -1) {
                        materiels.splice(index, 1);
                        localStorage.setItem('franchiniOccasions', JSON.stringify(materiels));
                        updateMaterielsTable();
                    }
                }
            }

            function resetTracteurForm() {
                document.getElementById('tracteur-form').reset();
                document.getElementById('tracteur-location-details').style.display = 'none';
                document.getElementById('tracteur-preview').innerHTML = '';
                document.getElementById('add-tracteur-btn').innerHTML = '<i class="fas fa-plus"></i> Ajouter le tracteur';
                currentEditId = null;
            }

            function resetMaterielForm() {
                document.getElementById('materiel-form').reset();
                document.getElementById('materiel-location-details').style.display = 'none';
                document.getElementById('materiel-preview').innerHTML = '';
                document.getElementById('add-materiel-btn').innerHTML = '<i class="fas fa-plus"></i> Ajouter le matériel';
                currentEditId = null;
            }

            // Gestion des promotions
            const addPromoBtn = document.getElementById('add-promo-btn');
            const promosTableBody = document.getElementById('promos-table-body');
            const promos = JSON.parse(localStorage.getItem('franchiniPromos')) || []; // Stockage pour les promotions
            let currentPromoEditId = null;

            if (addPromoBtn) {
                addPromoBtn.addEventListener('click', function() {
                    const title = document.getElementById('promo-title').value;
                    const description = document.getElementById('promo-description').value;
                    const dateDebut = document.getElementById('promo-date-debut').value;
                    const dateFin = document.getElementById('promo-date-fin').value;
                    // const image = document.getElementById('promo-image').files[0]; // Gestion d'image à affiner

                    if (title && dateDebut && dateFin) {
                        const promo = { id: currentPromoEditId || Date.now(), title, description, dateDebut, dateFin }; //, imageName: image ? image.name : null };
                        if (currentPromoEditId) {
                            const index = promos.findIndex(p => p.id === currentPromoEditId);
                            promos[index] = promo;
                        } else {
                            promos.push(promo);
                        }
                        localStorage.setItem('franchiniPromos', JSON.stringify(promos));
                        updatePromosTable();
                        resetPromoForm();
                    } else {
                        alert('Veuillez remplir tous les champs obligatoires pour la promotion.');
                    }
                });
            }

            function updatePromosTable() {
                promosTableBody.innerHTML = '';
                promos.forEach(promo => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${promo.title}</td>
                        <td>${formatDate(promo.dateDebut)} - ${formatDate(promo.dateFin)}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${promo.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete" title="Supprimer" data-id="${promo.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    `;
                    promosTableBody.appendChild(tr);
                });
                // Add event listeners for new buttons
                document.querySelectorAll('#promos-table-body .action-btn.edit').forEach(btn => btn.addEventListener('click', e => editPromo(parseInt(e.currentTarget.dataset.id))));
                document.querySelectorAll('#promos-table-body .action-btn.delete').forEach(btn => btn.addEventListener('click', e => deletePromo(parseInt(e.currentTarget.dataset.id))));
            }
            
            function resetPromoForm() {
                document.getElementById('promo-form').reset();
                document.getElementById('promo-preview').innerHTML = '';
                addPromoBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter la promotion';
                currentPromoEditId = null;
            }

            function editPromo(id) {
                const promo = promos.find(p => p.id === id);
                if (!promo) return;
                currentPromoEditId = id;
                document.getElementById('promo-title').value = promo.title;
                document.getElementById('promo-description').value = promo.description;
                document.getElementById('promo-date-debut').value = promo.dateDebut;
                document.getElementById('promo-date-fin').value = promo.dateFin;
                addPromoBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                document.querySelector('#promotions .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deletePromo(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cette promotion ?')) {
                    const index = promos.findIndex(p => p.id === id);
                    if (index !== -1) {
                        promos.splice(index, 1);
                        localStorage.setItem('franchiniPromos', JSON.stringify(promos));
                        updatePromosTable();
                    }
                }
            }

            // Gestion des contacts
            const addContactBtn = document.getElementById('add-contact-btn');
            const contactsTableBody = document.getElementById('contacts-table-body');
            const contacts = JSON.parse(localStorage.getItem('franchiniContacts')) || []; // Stockage pour les contacts
            let currentContactEditId = null;

            if (addContactBtn) {
                addContactBtn.addEventListener('click', function() {
                    const service = document.getElementById('contact-service').value;
                    const nom = document.getElementById('contact-nom').value;
                    const prenom = document.getElementById('contact-prenom').value;
                    const fonction = document.getElementById('contact-fonction').value;
                    const tel = document.getElementById('contact-tel').value;
                    const email = document.getElementById('contact-email').value;

                    if (service && nom && prenom && fonction) {
                        const contact = { id: currentContactEditId || Date.now(), service, nom, prenom, fonction, tel, email };
                        if (currentContactEditId) {
                            const index = contacts.findIndex(c => c.id === currentContactEditId);
                            contacts[index] = contact;
                        } else {
                            contacts.push(contact);
                        }
                        localStorage.setItem('franchiniContacts', JSON.stringify(contacts));
                        updateContactsTable();
                        resetContactForm();
                    } else {
                        alert('Veuillez remplir les champs Service, Nom, Prénom et Fonction.');
                    }
                });
            }

            function updateContactsTable() {
                contactsTableBody.innerHTML = '';
                contacts.forEach(contact => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${contact.service.charAt(0).toUpperCase() + contact.service.slice(1)}</td>
                        <td>${contact.nom} ${contact.prenom}</td>
                        <td>${contact.fonction}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${contact.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete" title="Supprimer" data-id="${contact.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    `;
                    contactsTableBody.appendChild(tr);
                });
                document.querySelectorAll('#contacts-table-body .action-btn.edit').forEach(btn => btn.addEventListener('click', e => editContact(parseInt(e.currentTarget.dataset.id))));
                document.querySelectorAll('#contacts-table-body .action-btn.delete').forEach(btn => btn.addEventListener('click', e => deleteContact(parseInt(e.currentTarget.dataset.id))));
            }

            function resetContactForm() {
                document.getElementById('contact-form').reset();
                addContactBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter le contact';
                currentContactEditId = null;
            }

            function editContact(id) {
                const contact = contacts.find(c => c.id === id);
                if (!contact) return;
                currentContactEditId = id;
                document.getElementById('contact-service').value = contact.service;
                document.getElementById('contact-nom').value = contact.nom;
                document.getElementById('contact-prenom').value = contact.prenom;
                document.getElementById('contact-fonction').value = contact.fonction;
                document.getElementById('contact-tel').value = contact.tel;
                document.getElementById('contact-email').value = contact.email;
                addContactBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                document.querySelector('#contacts .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deleteContact(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer ce contact ?')) {
                    const index = contacts.findIndex(c => c.id === id);
                    if (index !== -1) {
                        contacts.splice(index, 1);
                        localStorage.setItem('franchiniContacts', JSON.stringify(contacts));
                        updateContactsTable();
                    }
                }
            }
            
            // Initialisation des dropzones
            setupDropzone('tracteur-dropzone', 'tracteur-photos', 'tracteur-preview');
            setupDropzone('materiel-dropzone', 'materiel-photos', 'materiel-preview');
            setupDropzone('promo-dropzone', 'promo-image', 'promo-preview');

            // Gestion du carrousel d'accueil
            const carouselItems = JSON.parse(localStorage.getItem('franchiniCarousel')) || [];
            let currentEditId = null;
            
            // Éléments du formulaire
            const mediaTypeSelect = document.getElementById('media-type');
            const imageUploadSection = document.getElementById('image-upload-section');
            const youtubeSection = document.getElementById('youtube-section');
            const mediaUpload = document.getElementById('media-upload');
            const mediaPreview = document.getElementById('media-preview');
            const youtubeUrl = document.getElementById('youtube-url');
            const mediaTitle = document.getElementById('media-title');
            const mediaDescription = document.getElementById('media-description');
            const mediaLink = document.getElementById('media-link');
            const linkText = document.getElementById('link-text');
            const addMediaBtn = document.getElementById('add-media-btn');
            const carouselItemsContainer = document.getElementById('carousel-items');
            
            // Gestion du changement d'URL YouTube
            if (youtubeUrl) {
                youtubeUrl.addEventListener('input', function() {
                    // Vérifier si l'URL est une URL YouTube valide
                    if (this.value && (this.value.includes('youtube.com/') || this.value.includes('youtu.be/'))) {
                        const youtubeId = extractYoutubeId(this.value);
                        if (youtubeId) {
                            // Afficher l'aperçu de la vidéo YouTube
                            handleFiles([this.value], true);
                            // Activer le bouton d'ajout
                            if (addMediaBtn) {
                                addMediaBtn.disabled = false;
                            }
                        } else {
                            // Afficher un message d'erreur
                            if (mediaPreview) {
                                mediaPreview.innerHTML = `
                                    <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                        <i class="fas fa-exclamation-triangle"></i> URL YouTube invalide. Veuillez vérifier le lien.
                                    </div>
                                `;
                            }
                            // Désactiver le bouton d'ajout si l'URL n'est pas valide
                            if (addMediaBtn) {
                                addMediaBtn.disabled = true;
                            }
                        }
                    } else if (this.value === '') {
                        // Si le champ est vide, effacer l'aperçu et désactiver le bouton d'ajout
                        if (mediaPreview) {
                            mediaPreview.innerHTML = '';
                        }
                        if (addMediaBtn) {
                            addMediaBtn.disabled = true;
                        }
                    }
                });
            }
            
            // Basculer entre les types de médias
            mediaTypeSelect.addEventListener('change', function() {
                if (this.value === 'image') {
                    imageUploadSection.style.display = 'block';
                    youtubeSection.style.display = 'none';
                } else {
                    imageUploadSection.style.display = 'none';
                    youtubeSection.style.display = 'block';
                }
            });
            
            // Gestion du glisser-déposer pour les images
            const dropzone = document.getElementById('media-dropzone');
            
            if (dropzone && mediaUpload) {
                // Empêcher le comportement par défaut pour tous les événements de glisser-déposer
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                // Mettre en surbrillance la zone de dépôt
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropzone.addEventListener(eventName, highlight, false);
                });
                
                // Retirer la surbrillance
                ['dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    dropzone.classList.add('highlight');
                }
                
                function unhighlight() {
                    dropzone.classList.remove('highlight');
                }
                
                // Gérer le dépôt de fichiers
                dropzone.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    unhighlight();
                    
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    const text = dt.getData('text/plain');
                    
                    // Vérifier si c'est une URL YouTube collée
                    if (text && (text.includes('youtube.com/watch') || text.includes('youtu.be/'))) {
                        if (youtubeUrl) {
                            youtubeUrl.value = text;
                            // Simuler un clic sur le bouton d'ajout après un court délai
                            setTimeout(() => {
                                if (addMediaBtn) addMediaBtn.click();
                            }, 100);
                        }
                        return;
                    }
                    
                    // Gestion des fichiers déposés
                    if (files.length > 0) {
                        // Vérifier si c'est une image
                        const file = files[0];
                        if (file.type.startsWith('image/')) {
                            // Créer un nouveau DataTransfer pour mettre à jour les fichiers
                            const dataTransfer = new DataTransfer();
                            dataTransfer.items.add(file);
                            mediaUpload.files = dataTransfer.files;
                            
                            // Déclencher l'événement change manuellement
                            const event = new Event('change');
                            mediaUpload.dispatchEvent(event);
                        } else {
                            // Afficher un message d'erreur pour les types de fichiers non supportés
                            if (mediaPreview) {
                                mediaPreview.innerHTML = `
                                    <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                        <i class="fas fa-exclamation-triangle"></i> Format non supporté. Veuillez déposer une image (JPG, PNG, etc.) ou une URL YouTube.
                                    </div>
                                `;
                            }
                        }
                    }
                }
                
                // Gérer le clic sur la zone de dépôt
                dropzone.addEventListener('click', () => {
                    mediaUpload.click();
                });
            }
            
            // Gérer la sélection de fichiers via le bouton
            if (mediaUpload) {
                mediaUpload.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        handleFiles(this.files);
                    }
                });
            }
            
            function handleFiles(files, isYoutubeUrl = false) {
                if (!files || files.length === 0) return;
                
                const file = files[0];
                if (!file) return;
                
                // Vérifier si c'est une URL YouTube
                if (isYoutubeUrl) {
                    const youtubeId = extractYoutubeId(file);
                    if (!youtubeId) {
                        if (mediaPreview) {
                            mediaPreview.innerHTML = `
                                <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                    <i class="fas fa-exclamation-triangle"></i> URL YouTube invalide. Veuillez vérifier le lien.
                                </div>
                            `;
                        }
                        return;
                    }
                    
                    // Afficher l'aperçu de la vidéo YouTube
                    if (mediaPreview) {
                        mediaPreview.innerHTML = `
                            <div class="youtube-preview" style="margin-top: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; text-align: center;">
                                <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 10px; background: #000;">
                                    <img src="https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg" alt="Miniature YouTube" style="width: 100%; height: auto; opacity: 0.8;">
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                        <div style="width: 68px; height: 48px; background: #ff0000; border-radius: 20%; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="this.parentNode.parentNode.parentNode.querySelector('iframe').style.display='block'; this.parentNode.parentNode.style.display='none';">
                                            <i class="fas fa-play" style="color: white; font-size: 20px; margin-left: 4px;"></i>
                                        </div>
                                    </div>
                                    <iframe id="ytplayer" type="text/html" width="100%" height="100%"
                                        src="https://www.youtube.com/embed/${youtubeId}?enablejsapi=1&origin=${window.location.origin}"
                                        frameborder="0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none;"></iframe>
                                </div>
                                <div style="font-size: 14px; color: #333; margin-bottom: 10px; text-align: left;">
                                    <div><strong>Type :</strong> Vidéo YouTube</div>
                                    <div><strong>URL :</strong> ${file}</div>
                                </div>
                                <button type="button" class="remove-media-btn" style="background: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; font-size: 13px; display: flex; align-items: center; margin: 0 auto;">
                                    <i class="fas fa-times" style="margin-right: 5px;"></i> Supprimer la vidéo
                                </button>
                            </div>
                        `;
                        
                        // Ajouter un écouteur d'événement pour le bouton de suppression
                        const removeBtn = mediaPreview.querySelector('.remove-media-btn');
                        if (removeBtn) {
                            removeBtn.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                mediaPreview.innerHTML = '';
                                if (youtubeUrl) {
                                    youtubeUrl.value = '';
                                }
                            });
                        }
                    }
                    return;
                }
                
                // Vérifier le type de fichier pour les images
                if (!file.type.startsWith('image/')) {
                    if (mediaPreview) {
                        mediaPreview.innerHTML = `
                            <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Format de fichier non supporté. Veuillez utiliser une image (JPG, PNG, etc.) ou une URL YouTube.
                            </div>
                        `;
                    }
                    return;
                }
                
                // Vérifier la taille du fichier (max 5MB)
                const maxSize = 5 * 1024 * 1024; // 5MB
                if (file.size > maxSize) {
                    if (mediaPreview) {
                        mediaPreview.innerHTML = `
                            <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Le fichier est trop volumineux (${Math.round(file.size / (1024 * 1024) * 10) / 10} MB). La taille maximale est de 5MB.
                            </div>
                        `;
                    }
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (!mediaPreview) return;
                    
                    // Créer un conteneur pour l'aperçu avec un bouton de suppression
                    mediaPreview.innerHTML = `
                        <div class="media-preview-container" style="position: relative; display: inline-block; margin-top: 10px; width: 100%; max-width: 500px;">
                            <div style="position: relative; border: 1px solid #dee2e6; border-radius: 4px; overflow: hidden; background: #f8f9fa;">
                                <img src="${e.target.result}" alt="Aperçu" style="max-width: 100%; max-height: 300px; display: block; margin: 0 auto;">
                                <button type="button" class="remove-media-btn" style="position: absolute; top: 10px; right: 10px; background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 14px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div style="font-size: 13px; color: #666; margin-top: 8px; text-align: left; padding: 0 5px;">
                                <div><strong>Nom :</strong> ${file.name}</div>
                                <div><strong>Taille :</strong> ${(file.size / 1024).toFixed(1)} KB</div>
                                <div><strong>Type :</strong> ${file.type}</div>
                            </div>
                        </div>
                    `;
                    
                    // Ajouter un écouteur d'événement pour le bouton de suppression
                    const removeBtn = mediaPreview.querySelector('.remove-media-btn');
                    if (removeBtn) {
                        removeBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            mediaPreview.innerHTML = '';
                            if (mediaUpload) {
                                mediaUpload.value = '';
                            }
                        });
                    }
                };
                
                reader.onerror = function() {
                    if (mediaPreview) {
                        mediaPreview.innerHTML = `
                            <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Erreur lors de la lecture du fichier. Veuillez réessayer avec une autre image.
                            </div>
                        `;
                    }
                };
                
                reader.readAsDataURL(file);
            }
            
            // Ajouter un élément au carrousel
            if (addMediaBtn) {
                addMediaBtn.addEventListener('click', function() {
                    try {
                        // Désactiver le bouton pour éviter les clics multiples
                        addMediaBtn.disabled = true;
                        addMediaBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement en cours...';
                        
                        const type = mediaTypeSelect ? mediaTypeSelect.value : 'image';
                        
                        if (type === 'image') {
                            // Vérifier si un fichier a été sélectionné via l'input file
                            if (mediaUpload && mediaUpload.files && mediaUpload.files.length > 0) {
                                const file = mediaUpload.files[0];
                                
                                // Vérifier la taille du fichier (max 5MB)
                                const maxSize = 5 * 1024 * 1024; // 5MB
                                if (file.size > maxSize) {
                                    alert('Le fichier est trop volumineux. La taille maximale est de 5MB.');
                                    addMediaBtn.disabled = false;
                                    addMediaBtn.innerHTML = currentEditId ? 
                                        '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                        '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                    return;
                                }
                                
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    try {
                                        const mediaUrl = e.target.result;
                                        addCarouselItem(type, mediaUrl);
                                    } catch (error) {
                                        console.error('Erreur lors du traitement de l\'image:', error);
                                        alert('Une erreur est survenue lors du traitement de l\'image. Veuillez réessayer.');
                                        addMediaBtn.disabled = false;
                                        addMediaBtn.innerHTML = currentEditId ? 
                                            '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                            '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                    }
                                };
                                
                                reader.onerror = function() {
                                    alert('Erreur lors de la lecture du fichier. Veuillez réessayer avec une autre image.');
                                    addMediaBtn.disabled = false;
                                    addMediaBtn.innerHTML = currentEditId ? 
                                        '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                        '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                };
                                
                                reader.readAsDataURL(file);
                                return; // On sort de la fonction ici, le reste sera géré dans le callback
                            } 
                            // Vérifier si une image est déjà affichée dans la prévisualisation (pour l'édition)
                            else if (mediaPreview && mediaPreview.querySelector('img') && currentEditId) {
                                const imgSrc = mediaPreview.querySelector('img').src;
                                if (imgSrc && imgSrc.startsWith('data:image/')) {
                                    addCarouselItem(type, imgSrc);
                                    return;
                                }
                            } 
                            else {
                                alert('Veuvez sélectionner une image à téléverser');
                                addMediaBtn.disabled = false;
                                addMediaBtn.innerHTML = currentEditId ? 
                                    '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                    '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                return;
                            }
                        } else {
                            // Pour les vidéos YouTube
                            const youtubeId = youtubeUrl ? extractYoutubeId(youtubeUrl.value.trim()) : null;
                            if (!youtubeId) {
                                alert('URL YouTube invalide. Veuillez entrer une URL YouTube valide.');
                                addMediaBtn.disabled = false;
                                addMediaBtn.innerHTML = currentEditId ? 
                                    '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                    '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                return;
                            }
                            
                            const mediaUrl = `https://www.youtube.com/embed/${youtubeId}`;
                            addCarouselItem(type, mediaUrl);
                        }
                    } catch (error) {
                        console.error('Erreur inattendue:', error);
                        alert('Une erreur inattendue est survenue. Veuillez réessayer.');
                        addMediaBtn.disabled = false;
                        addMediaBtn.innerHTML = currentEditId ? 
                            '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                            '<i class="fas fa-plus"></i> Ajouter au carrousel';
                    }
                });
            }
            
            // Fonction pour ajouter un élément au carrousel
            function addCarouselItem(type, mediaUrl) {
                try {
                    if (!mediaUrl) {
                        console.error('Aucune URL de média fournie');
                        return;
                    }
                    
                    // Vérifier si c'est une URL YouTube valide pour le type vidéo
                    if (type === 'youtube') {
                        const youtubeId = extractYoutubeId(mediaUrl);
                        if (!youtubeId) {
                            alert('URL YouTube invalide. Veuillez vérifier le lien.');
                            return;
                        }
                        mediaUrl = `https://www.youtube.com/embed/${youtubeId}`;
                    } else if (type === 'image' && !mediaUrl.startsWith('data:image/')) {
                        // Vérifier si c'est une image valide (format base64 ou URL)
                        console.error('Format d\'image non valide');
                        return;
                    }
                    
                    const item = {
                        id: currentEditId || Date.now(),
                        type: type,
                        url: mediaUrl,
                        title: mediaTitle ? mediaTitle.value.trim() : '',
                        description: mediaDescription ? mediaDescription.value.trim() : '',
                        link: mediaLink ? mediaLink.value.trim() : '',
                        linkText: linkText ? (linkText.value.trim() || 'Voir plus') : 'Voir plus',
                        order: currentEditId ? carouselItems.find(item => item.id === currentEditId)?.order || carouselItems.length : carouselItems.length,
                        createdAt: new Date().toISOString()
                    };
                    
                    if (currentEditId) {
                        // Mise à jour d'un élément existant
                        const index = carouselItems.findIndex(item => item.id === currentEditId);
                        if (index !== -1) {
                            // Préserver la date de création originale
                            item.createdAt = carouselItems[index].createdAt;
                            carouselItems[index] = item;
                            console.log('Élément mis à jour avec succès:', item);
                        }
                        currentEditId = null;
                        if (addMediaBtn) {
                            addMediaBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter au carrousel';
                            addMediaBtn.disabled = false;
                        }
                    } else {
                        // Ajout d'un nouvel élément
                        carouselItems.push(item);
                        console.log('Nouvel élément ajouté avec succès:', item);
                    }
                    
                    saveCarousel();
                    updateCarouselDisplay();
                    resetForm();
                    
                    // Afficher un message de succès
                    const successMessage = document.createElement('div');
                    successMessage.className = 'alert alert-success';
                    successMessage.style.marginTop = '10px';
                    successMessage.style.padding = '10px';
                    successMessage.style.borderRadius = '4px';
                    successMessage.style.backgroundColor = '#d4edda';
                    successMessage.style.color = '#155724';
                    successMessage.style.border = '1px solid #c3e6cb';
                    successMessage.textContent = currentEditId ? 'Élément mis à jour avec succès !' : 'Élément ajouté avec succès !';
                    
                    const formCard = document.querySelector('#accueil .admin-card');
                    if (formCard) {
                        formCard.appendChild(successMessage);
                        // Supprimer le message après 3 secondes
                        setTimeout(() => {
                            if (successMessage.parentNode === formCard) {
                                formCard.removeChild(successMessage);
                            }
                        }, 3000);
                    }
                } catch (error) {
                    console.error('Erreur lors de l\'ajout de l\'élément au carrousel:', error);
                    alert('Une erreur est survenue lors de l\'ajout de l\'élément. Veuillez réessayer.');
                    
                    if (addMediaBtn) {
                        addMediaBtn.disabled = false;
                        addMediaBtn.innerHTML = currentEditId ? 
                            '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                            '<i class="fas fa-plus"></i> Ajouter au carrousel';
                    }
                }
            }
            
            // Extraire l'ID d'une URL YouTube
            function extractYoutubeId(url) {
                if (!url) return null;
                
                // Nettoyer l'URL des paramètres supplémentaires
                url = url.trim();
                
                // Gestion des URLs courtes youtu.be
                if (url.includes('youtu.be/')) {
                    const id = url.split('youtu.be/')[1];
                    return id ? id.split(/[?&#]/)[0] : null;
                }
                
                // Gestion des URLs complètes
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                
                if (match && match[2]) {
                    // Extraire l'ID et nettoyer les paramètres supplémentaires
                    const id = match[2].split(/[?&#]/)[0];
                    return id.length === 11 ? id : null;
                }
                
                return null;
            }
            
            // Mettre à jour l'affichage du carrousel
            function updateCarouselDisplay() {
                if (!carouselItemsContainer) return;
                
                carouselItemsContainer.innerHTML = '';
                
                // Trier les éléments par ordre
                const sortedItems = [...carouselItems].sort((a, b) => a.order - b.order);
                
                sortedItems.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'carousel-item';
                    itemElement.draggable = true;
                    itemElement.dataset.id = item.id;
                    
                    let mediaContent = '';
                    if (item.type === 'image') {
                        mediaContent = `<img src="${item.url}" alt="${item.title || 'Image du carrousel'}">`;
                    } else {
                        mediaContent = `<iframe src="${item.url}" frameborder="0" allowfullscreen></iframe>`;
                    }
                    
                    itemElement.innerHTML = `
                        <div class="carousel-item-preview">
                            ${mediaContent}
                        </div>
                        <div class="carousel-item-details">
                            ${item.title ? `<h4>${item.title}</h4>` : ''}
                            ${item.description ? `<p>${item.description}</p>` : ''}
                            ${item.link ? `<a href="${item.link}" class="carousel-item-link" target="_blank">${item.linkText}</a>` : ''}
                            <div class="carousel-item-actions">
                                <div class="carousel-item-buttons">
                                    <button class="edit-item" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-item" title="Supprimer">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <div class="drag-handle" title="Déplacer">
                                    <i class="fas fa-arrows-alt"></i>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Ajouter les gestionnaires d'événements
                    const editBtn = itemElement.querySelector('.edit-item');
                    const deleteBtn = itemElement.querySelector('.delete-item');
                    const dragHandle = itemElement.querySelector('.drag-handle');
                    
                    editBtn.addEventListener('click', () => editCarouselItem(item.id));
                    deleteBtn.addEventListener('click', () => deleteCarouselItem(item.id));
                    
                    // Ajouter les gestionnaires d'événements pour le glisser-déposer
                    if (itemElement) {
                        itemElement.addEventListener('dragstart', handleDragStart);
                        itemElement.addEventListener('dragover', handleDragOver);
                        itemElement.addEventListener('drop', handleDrop);
                        itemElement.addEventListener('dragend', handleDragEnd);
                        itemElement.addEventListener('dragleave', function() {
                            this.classList.remove('drag-over');
                        });
                    }
                    
                    carouselItemsContainer.appendChild(itemElement);
                });
            }
            
            // Réinitialiser le formulaire
            function resetForm() {
                mediaTypeSelect.value = 'image';
                mediaPreview.innerHTML = '';
                youtubeUrl.value = '';
                mediaTitle.value = '';
                mediaDescription.value = '';
                mediaLink.value = '';
                linkText.value = 'Voir plus';
                imageUploadSection.style.display = 'block';
                youtubeSection.style.display = 'none';
                // Réinitialiser l'input de fichier
                if (mediaUpload) {
                    mediaUpload.value = '';
                }
            }
            
            // Éditer un élément du carrousel
            function editCarouselItem(id) {
                try {
                    const item = carouselItems.find(item => item.id === id);
                    if (!item) {
                        console.error('Élément non trouvé avec l\'ID:', id);
                        return;
                    }
                    
                    currentEditId = id;
                    
                    // Remplir le formulaire avec les données de l'élément
                    if (mediaTypeSelect) {
                        mediaTypeSelect.value = item.type;
                        
                        // Afficher la section appropriée selon le type de média
                        if (item.type === 'image') {
                            imageUploadSection.style.display = 'block';
                            youtubeSection.style.display = 'none';
                            
                            // Afficher un aperçu de l'image existante
                            if (mediaPreview) {
                                mediaPreview.innerHTML = `
                                    <div class="media-preview-container" style="position: relative; display: inline-block; margin-top: 10px;">
                                        <img src="${item.url}" alt="Aperçu" style="max-width: 100%; max-height: 200px; display: block; border-radius: 4px;">
                                        <div style="font-size: 12px; color: #666; margin-top: 5px; text-align: center;">
                                            Image existante
                                        </div>
                                    </div>
                                `;
                            }
                        } else {
                            // Pour les vidéos YouTube
                            imageUploadSection.style.display = 'none';
                            youtubeSection.style.display = 'block';
                            if (youtubeUrl) {
                                const videoId = item.url.split('/').pop();
                                youtubeUrl.value = `https://www.youtube.com/watch?v=${videoId}`;
                            }
                        }
                    }
                    
                    // Remplir les champs du formulaire
                    if (mediaTitle) mediaTitle.value = item.title || '';
                    if (mediaDescription) mediaDescription.value = item.description || '';
                    if (mediaLink) mediaLink.value = item.link || '';
                    if (linkText) linkText.value = item.linkText || 'Voir plus';
                    
                    // Mettre à jour le bouton d'ajout
                    if (addMediaBtn) {
                        addMediaBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                        addMediaBtn.disabled = false;
                    }
                    
                    // Faire défiler vers le formulaire
                    const formHeader = document.querySelector('#accueil .admin-card h3');
                    if (formHeader) {
                        formHeader.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    console.log('Édition de l\'élément:', item);
                } catch (error) {
                    console.error('Erreur lors de l\'édition de l\'élément:', error);
                    alert('Une erreur est survenue lors du chargement de l\'élément à éditer.');
                }
            }
            
            // Supprimer un élément du carrousel
            function deleteCarouselItem(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cet élément du carrousel ?')) {
                    const index = carouselItems.findIndex(item => item.id === id);
                    if (index !== -1) {
                        carouselItems.splice(index, 1);
                        saveCarousel();
                        updateCarouselDisplay();
                    }
                }
            }
            
            // Enregistrer le carrousel dans le stockage local
            function saveCarousel() {
                localStorage.setItem('franchiniCarousel', JSON.stringify(carouselItems));
            }
            
            // Gestion du glisser-déposer pour le réordonnancement
            let draggedItem = null;
            
            function handleDragStart(e) {
                draggedItem = this;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleDrop(e) {
                e.stopPropagation();
                this.classList.remove('drag-over');
                
                if (draggedItem !== this) {
                    // Échanger les positions dans le tableau
                    const fromId = parseInt(draggedItem.dataset.id);
                    const toId = parseInt(this.dataset.id);
                    
                    const fromIndex = carouselItems.findIndex(item => item.id === fromId);
                    const toIndex = carouselItems.findIndex(item => item.id === toId);
                    
                    if (fromIndex !== -1 && toIndex !== -1) {
                        // Mettre à jour l'ordre
                        const [movedItem] = carouselItems.splice(fromIndex, 1);
                        carouselItems.splice(toIndex, 0, movedItem);
                        
                        // Mettre à jour les ordres
                        carouselItems.forEach((item, index) => {
                            item.order = index;
                        });
                        
                        saveCarousel();
                        updateCarouselDisplay();
                    }
                }
                
                return false;
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
                document.querySelectorAll('.carousel-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
            }
            
            // Initialisation
            if (carouselItemsContainer) {
                updateCarouselDisplay();
                
                // Ajouter les écouteurs d'événements pour le glisser-déposer sur le conteneur
                carouselItemsContainer.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    this.classList.add('drag-over-container');
                });
                
                carouselItemsContainer.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over-container');
                });
                
                carouselItemsContainer.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over-container');
                });
            }
            
            // Initialisation des données pour les autres onglets
            updateMaterielsTable();
            updateActualitesTable();
            updatePromosTable();
            updateContactsTable();

            // Gestion des actualités
            const addActualiteBtn = document.getElementById('add-actualite-btn');
            const actualitesTableBody = document.getElementById('actualites-table-body');

            if (addActualiteBtn) {
                addActualiteBtn.addEventListener('click', function() {
                    const titre = document.getElementById('actualite-titre').value;
                    const contenu = document.getElementById('actualite-contenu').value;
                    const date = document.getElementById('actualite-date').value;

                    if (titre && contenu && date) {
                        const actualite = { 
                            id: currentActualiteEditId || Date.now(), 
                            titre, 
                            contenu, 
                            date 
                        };
                        if (currentActualiteEditId) {
                            const index = actualites.findIndex(a => a.id === currentActualiteEditId);
                            if (index !== -1) actualites[index] = actualite;
                        } else {
                            actualites.push(actualite);
                        }
                        localStorage.setItem('franchiniActualites', JSON.stringify(actualites));
                        updateActualitesTable();
                        resetActualiteForm();
                    } else {
                        alert('Veuillez remplir tous les champs pour l\'actualité.');
                    }
                });
            }

            function updateActualitesTable() {
                if (!actualitesTableBody) return;
                actualitesTableBody.innerHTML = '';
                actualites.sort((a, b) => new Date(b.date) - new Date(a.date)); // Trier par date décroissante
                actualites.forEach(actualite => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${actualite.titre}</td>
                        <td>${formatDate(actualite.date)}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${actualite.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete" title="Supprimer" data-id="${actualite.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    `;
                    actualitesTableBody.appendChild(tr);
                });
                document.querySelectorAll('#actualites-table-body .action-btn.edit').forEach(btn => btn.addEventListener('click', e => editActualite(parseInt(e.currentTarget.dataset.id))));
                document.querySelectorAll('#actualites-table-body .action-btn.delete').forEach(btn => btn.addEventListener('click', e => deleteActualite(parseInt(e.currentTarget.dataset.id))));
            }

            function resetActualiteForm() {
                document.getElementById('actualite-form').reset();
                addActualiteBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter l\'actualité';
                currentActualiteEditId = null;
            }

            function editActualite(id) {
                const actualite = actualites.find(a => a.id === id);
                if (!actualite) return;
                currentActualiteEditId = id;
                document.getElementById('actualite-titre').value = actualite.titre;
                document.getElementById('actualite-contenu').value = actualite.contenu;
                document.getElementById('actualite-date').value = actualite.date; // HTML date input expects YYYY-MM-DD
                addActualiteBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                document.querySelector('#actualites .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deleteActualite(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cette actualité ?')) {
                    const index = actualites.findIndex(a => a.id === id);
                    if (index !== -1) {
                        actualites.splice(index, 1);
                        localStorage.setItem('franchiniActualites', JSON.stringify(actualites));
                        updateActualitesTable();
                    }
                }
            }

            function setupDropzone(dropzoneId, inputId, previewId) {
                const dropzone = document.getElementById(dropzoneId);
                const input = document.getElementById(inputId);
                const preview = document.getElementById(previewId);
                
                if (dropzone && input && preview) {
                    dropzone.addEventListener('click', () => input.click());
                    dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
                    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
                    dropzone.addEventListener('drop', e => {
                        e.preventDefault();
                        dropzone.classList.remove('dragover');
                        if (e.dataTransfer.files.length > 0) {
                            input.files = e.dataTransfer.files;
                            handleFiles(input.files, preview);
                        }
                    });
                    input.addEventListener('change', () => handleFiles(input.files, preview));
                }
            }

            function handleFiles(files, preview) {
                if (!preview || !files || files.length === 0) return;
                
                preview.innerHTML = '';
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file && file.type && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const thumbnail = document.createElement('div');
                            thumbnail.className = 'thumbnail';
                            thumbnail.innerHTML = `<img src="${e.target.result}" alt="Aperçu" style="max-width: 100%; max-height: 200px;"><div class="thumbnail-name">${file.name}</div>`;
                            preview.appendChild(thumbnail);
                        };
                        reader.readAsDataURL(file);
                    } else if (preview) {
                        preview.innerHTML = '<p>Format de fichier non supporté. Veuillez utiliser une image.</p>';
                    }
                }
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
        }); // Fin de l'écouteur d'événement DOMContentLoaded
    </script>
</body>
</html>
