---
layout: default
title: Administration - Franchini
description: "Espace d'administration du site Franchini"
---

<!-- Vérification de l'authentification -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="{{ '/assets/js/auth/supabase-config.js' | relative_url }}"></script>
    <script>
        // Vérifier l'authentification avant de charger la page
        document.addEventListener('DOMContentLoaded', async function() {
            // VÃ©rifier la session
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (error || !session) {
                // Rediriger vers la page de connexion si non authentifié
                window.location.href = 'connexion-prive.html';
                return;
            }
            
            // Si l'utilisateur est authentifiÃ©, le reste de la page se charge normalement
        });
    </script>
{% include head.html %}
<link rel="stylesheet" href="{{ '/assets/css/admin.css' | relative_url }}">
    <style>
        /* Style du logo */
        .logo-link {
            text-decoration: none;
            position: relative;
            display: block;
        }

        .logo-text {
            font-family: Arial, sans-serif;
            font-size: 32px;
            font-weight: bold;
            color: #333;
            letter-spacing: 1px;
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 20px;
        }

        .header-social {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-social .social-icon {
            color: #888;
            font-size: 20px;
            transition: color 0.3s, transform 0.3s;
            opacity: 0.7;
        }

        .header-social .social-icon:hover {
            color: #3D6AA2;
            transform: translateY(-2px);
            opacity: 1;
        }

        @media (max-width: 768px) {
            .logo-text {
                font-size: 24px;
            }
        }

        /* Styles pour les zones de dÃ©pÃ´t */
        .dropzone {
            border: 2px dashed #aaa;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
            position: relative;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dropzone.highlight {
            border-color: #007bff;
            background-color: #e7f1ff;
        }
        
        .dropzone p, .dropzone span {
            color: #666;
            margin: 0;
        }
        
        .dropzone i {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
            color: #007bff;
        }
        
        .preview-container {
            margin-top: 15px;
        }
        
        .preview-container img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        
        /* Styles pour le carrousel */
        .carousel-items-container {
            margin-top: 20px;
        }
        
        .carousel-item {
            display: flex;
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background-color: #fff;
        }
        
        .carousel-item-preview {
            width: 200px;
            margin-right: 20px;
        }
        
        .carousel-item-preview img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        
        .carousel-item-details {
            flex: 1;
        }
        
        .carousel-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }
        
        .carousel-item p {
            margin-bottom: 10px;
            color: #666;
        }
        
        .carousel-item-link {
            display: inline-block;
            margin-top: 10px;
            color: #007bff;
            text-decoration: none;
        }
        
        .carousel-item-link:hover {
            text-decoration: underline;
        }
        
        .carousel-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        .carousel-item-buttons button {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            margin-right: 10px;
            font-size: 16px;
        }
        
        .carousel-item-buttons button:hover {
            color: #0056b3;
        }
        
        .drag-handle {
            cursor: move;
            color: #6c757d;
            font-size: 16px;
        }
        
        .drag-handle:hover {
            color: #0056b3;
        }
        
        .dragging {
            opacity: 0.5;
        }
        
        .drag-over {
            border: 2px dashed #007bff !important;
        }
        
        .remove-media-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            font-size: 13px;
        }
        
        .remove-media-btn i {
            margin-right: 5px;
            font-size: 12px;
        }
        
        /* Styles gÃ©nÃ©raux */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Admin */
        .admin-header {
            background-color: #4CAF50;
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        .admin-header .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .admin-header .user-name {
            font-weight: 500;
        }

        .header-social .logout-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            margin-left: 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
            text-decoration: none;
        }

        .admin-header .logout-btn i {
            margin-right: 0.5rem;
        }

        .admin-header .logout-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }

        /* Styles pour le logo et la navigation */
        .main-header {
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-text {
            font-family: Arial, sans-serif;
            font-size: 32px;
            font-weight: bold;
            color: #333;
            letter-spacing: 1px;
            position: relative;
            text-decoration: none;
        }

        .logo-text::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%) scaleX(0.7);
            width: 100%;
            height: 3px;
            background-color: #4CAF50;
        }

        .header-social {
            display: flex;
            gap: 15px;
            margin-left: 20px;
        }

        .header-social .social-icon {
            color: #888;
            font-size: 20px;
            transition: color 0.3s;
            opacity: 0.7;
        }

        .header-social .social-icon:hover {
            color: #3D6AA2;
            opacity: 1;
        }

        .main-nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
            margin: 0;
            padding: 0;
        }

        .main-nav a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 0;
            position: relative;
        }

        .main-nav a:hover {
            color: #4CAF50;
        }
        
        /* Style du bouton de dÃ©connexion dans la barre de navigation */
        .logout-nav-item {
            margin-left: 5px;
        }
        
        .logout-nav-btn {
            color: #333;
            text-decoration: none;
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .logout-nav-btn:hover {
            background-color: #f5f5f5;
            color: #dc3545;
        }
        
        .logout-nav-btn i {
            font-size: 0.9em;
        }

        .phone-number {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #333;
            text-decoration: none;
            font-weight: 500;
        }

        .phone-number i {
            color: #4CAF50;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            color: #4CAF50;
        }

        .tab-btn.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        .tab-btn i {
            margin-right: 0.5rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cards */
        .admin-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card h2 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: #333;
            font-size: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.8rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: #4CAF50;
            outline: none;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #388e3c;
        }

        .btn-secondary {
            background-color: #757575;
        }

        .btn-secondary:hover {
            background-color: #616161;
        }

        .btn-danger {
            background-color: #f44336;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        /* Tables */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .admin-table th {
            font-weight: 500;
            color: #555;
            background-color: #f9f9f9;
        }

        .admin-table tr:hover {
            background-color: #f5f5f5;
        }

        .action-btns {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background-color: #eee;
            color: #333;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background-color: #ddd;
        }

        .action-btn.edit:hover {
            background-color: #4CAF50;
            color: white;
        }

        .action-btn.delete:hover {
            background-color: #f44336;
            color: white;
        }

        /* Dropzone */
        .dropzone {
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }
        
        .dropzone:hover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
        }

        .dropzone.dragover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }

        .dropzone i {
            font-size: 2rem;
            color: #888;
            margin-bottom: 10px;
        }

        /* Styles pour les vignettes d'aperÃ§u */
        .thumbnail-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .thumbnail {
            width: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .thumbnail img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        .thumbnail-name {
            font-size: 0.7rem;
            padding: 3px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
        }

        /* Styles pour les formulaires de location */
        #tracteur-location-details,
        #materiel-location-details {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        /* Styles pour les radios et checkboxes */
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-label input {
            margin-right: 5px;
        }

        /* DÃ©jÃ  dÃ©fini plus haut */

        .dropzone i {
            font-size: 2rem;
            color: #4CAF50;
            margin-bottom: 1rem;
        }
        
        /* Styles pour le carrousel d'accueil */
        .carousel-items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .carousel-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .carousel-item-preview {
            position: relative;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: #f5f5f5;
            overflow: hidden;
        }
        
        .carousel-item-preview img,
        .carousel-item-preview iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .carousel-item-details {
            padding: 15px;
        }
        
        .carousel-item-details h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .carousel-item-details p {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 0.9em;
        }
        
        .carousel-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }
        
        .carousel-item-link {
            color: #4CAF50;
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .carousel-item-link:hover {
            text-decoration: underline;
        }
        
        /* Styles pour le glisser-dÃ©poser */
        .carousel-item {
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .carousel-item.dragging {
            opacity: 0.5;
            transform: scale(0.98);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .carousel-item.drag-over {
            border: 2px dashed #4CAF50;
            border-radius: 4px;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .carousel-items-container.drag-over-container {
            background-color: rgba(76, 175, 80, 0.05);
            border: 2px dashed #4CAF50;
            border-radius: 4px;
            min-height: 100px;
            transition: all 0.2s;
        }
        
        .drag-handle {
            cursor: move;
            padding: 5px;
            color: #666;
            transition: color 0.2s;
        }
        
        .drag-handle:hover {
            color: #4CAF50;
        }
        
        .carousel-item-buttons button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1em;
        }
        
        .carousel-item-buttons button:hover {
            color: #e74c3c;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn i {
            margin-right: 0.5rem;
        }
        
        .btn:hover {
            background-color: #45a049;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        /* Styles pour le carrousel d'actualitÃ©s */
        .upload-group {
            margin-bottom: 1.5rem;
        }
        
        .dropzone {
            border: 2px dashed #ccc;
            border-radius: 4px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            background-color: #f9f9f9;
        }
        
        .dropzone:hover {
            border-color: #4CAF50;
            background-color: #f0f8f0;
        }
        
        .dropzone i {
            font-size: 2rem;
            color: #4CAF50;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .preview-container {
            margin-top: 1rem;
            min-height: 100px;
            border: 1px solid #eee;
            padding: 1rem;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .preview-container img,
        .preview-container video {
            max-width: 100%;
            max-height: 200px;
            display: block;
            margin: 0 auto;
        }
        
        .sortable-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .carousel-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: move;
            transition: all 0.3s ease;
        }
        
        .carousel-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .carousel-item-preview {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 1rem;
        }
        
        .carousel-item-details {
            flex: 1;
        }
        
        .carousel-item-title {
            font-weight: 500;
            margin: 0 0 0.25rem 0;
        }
        
        .carousel-item-dates {
            font-size: 0.85rem;
            color: #666;
        }
        
        .carousel-item-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-edit, .btn-delete {
            padding: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background-color: #2196F3;
            color: white;
        }
        
        .btn-delete {
            background-color: #f44336;
            color: white;
        }
        
        .btn-edit:hover, .btn-delete:hover {
            opacity: 0.9;
        }
        
        .hint {
            color: #666;
            font-style: italic;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }
        
        .preview-container {
            margin-top: 1rem;
        }
        
        .preview-container img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            margin-top: 0.5rem;
        }

        .dropzone p {
            margin: 0;
            color: #666;
        }

        .thumbnail-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* Radio & Checkbox */
        .radio-group {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-label input {
            margin-right: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
{% include header.html %}

<div class="admin-container">
                    <div class="logo-text">FRANCHINI</div>
                </a>
                <div class="header-social">
                    <a href="https://www.facebook.com/franchinimarches" target="_blank" class="social-icon">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://www.instagram.com/franchini_deutzfahr" target="_blank" class="social-icon">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="concession.html">La concession</a></li>
                    <li class="dropdown">
                        <a href="#">MatÃ©riel neuf</a>
                        <div class="dropdown-content">
                            <a href="materiel.html">MatÃ©riel neuf</a>
                            <a href="materiel-disponible.html">MatÃ©riel neuf disponible</a>
                        </div>
                    </li>
                    <li><a href="location.html">Location</a></li>
                    <li><a href="occasion.html">Occasion</a></li>
                    <li><a href="magasin.html">Magasin</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="tel:0475474037" class="phone-number"><i class="fas fa-phone"></i> 04 75 47 40 37</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="admin-header">
        <div class="container">
            <div class="user-info">
                <h1>Panneau d'administration</h1>
                <div>
                    <span class="user-name">ConnectÃ© en tant que Cedric</span>
                    <a href="connexion-prive.html" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        DÃ©connexion
                    </a>
                </div>
            </div>
        </div>
    </div>

    <main class="container">
            <div style="background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem; overflow: hidden;">
                <div class="tabs" style="display: flex; flex-wrap: wrap; gap: 0; border-bottom: 1px solid #e0e0e0;">
                    <button class="tab-btn active" data-tab="accueil" style="padding: 0.75rem 1rem; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-bottom: 2px solid transparent;">
                        <i class="fas fa-home" style="margin-right: 0.5rem;"></i> Bandeau d'accueil
                    </button>
                    <a href="https://supabase.com/dashboard/project/svvupcjjqyyehxbxlkro/auth/users?f={\"search_query\":\"1b13f9b9-a4ab-47da-b29b-9839b126f69b\"}" 
                       target="_blank" 
                       class="tab-btn" 
                       style="padding: 0.75rem 1rem; white-space: nowrap; text-decoration: none; color: inherit; font-size: 0.9rem; display: flex; align-items: center; border-bottom: 2px solid transparent;">
                        <i class="fas fa-users" style="margin-right: 0.5rem;"></i> Utilisateurs
                    </a>
                    <button class="tab-btn" data-tab="actualites" style="padding: 0.75rem 1rem; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-bottom: 2px solid transparent;">
                        <i class="fas fa-newspaper" style="margin-right: 0.5rem;"></i> ActualitÃ©s
                    </button>
                    <button class="tab-btn" data-tab="occasions" style="padding: 0.75rem 1rem; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-bottom: 2px solid transparent;">
                        <i class="fas fa-car" style="margin-right: 0.5rem;"></i> Occasions
                    </button>
                    <button class="tab-btn" data-tab="promotions" style="padding: 0.75rem 1rem; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-bottom: 2px solid transparent;">
                        <i class="fas fa-tags" style="margin-right: 0.5rem;"></i> Promotions
                    </button>
                    <button class="tab-btn" data-tab="contacts" style="padding: 0.75rem 1rem; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-bottom: 2px solid transparent;">
                        <i class="fas fa-address-book" style="margin-right: 0.5rem;"></i> Contacts
                    </button>
                    <div style="margin-left: auto; display: flex; align-items: center;">
                        <button id="logout-btn" class="tab-btn" style="color: #dc3545; padding: 0.75rem 1rem; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; border-bottom: 2px solid transparent;">
                            <i class="fas fa-sign-out-alt" style="margin-right: 0.5rem;"></i> DÃ©connexion
                        </button>
                    </div>
                </div>
            </div>

            <div id="accueil" class="tab-content active">
                <h2>Personnalisation du bandeau d'accueil</h2>
                <div class="admin-card">
                    <h3>Gestion du carrousel</h3>
                    <div class="form-group">
                        <label for="media-type">Type de mÃ©dia :</label>
                        <select id="media-type" class="form-control">
                            <option value="image">Image</option>
                            <option value="youtube">VidÃ©o YouTube</option>
                        </select>
                    </div>
                    
                    <div id="image-upload-section">
                        <div class="form-group">
                            <label for="media-upload">TÃ©lÃ©verser une image :</label>
                            <div class="dropzone" id="media-dropzone">
                                <p>Glissez-dÃ©posez une image ici ou cliquez pour sÃ©lectionner</p>
                                <input type="file" id="media-upload" accept="image/*" style="display: none;">
                            </div>
                            <div id="media-preview" class="preview-container"></div>
                        </div>
                    </div>
                    
                    <div id="youtube-section" style="display: none;">
                        <div class="form-group">
                            <label for="youtube-url">URL de la vidÃ©o YouTube :</label>
                            <input type="text" id="youtube-url" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="media-title">Titre (optionnel) :</label>
                        <input type="text" id="media-title" class="form-control" placeholder="Titre du mÃ©dia">
                    </div>
                    
                    <div class="form-group">
                        <label for="media-description">Description (optionnel) :</label>
                        <textarea id="media-description" class="form-control" rows="3" placeholder="Description du mÃ©dia"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="media-link">Lien (optionnel) :</label>
                        <input type="url" id="media-link" class="form-control" placeholder="https://exemple.com">
                        <label for="link-text">Texte du lien :</label>
                        <input type="text" id="link-text" class="form-control" placeholder="Voir plus">
                    </div>
                    
                    <button type="button" id="add-media-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ajouter au carrousel
                    </button>
                </div>
                
                <div class="admin-card">
                    <h3>Ã‰lÃ©ments du carrousel</h3>
                    <div id="carousel-items" class="carousel-items-container">
                        <!-- Les Ã©lÃ©ments du carrousel seront ajoutÃ©s ici dynamiquement -->
                    </div>
                </div>
            </div>
            
            <div id="actualites" class="tab-content">
                <h2>Gestion du Carrousel d'Actualités</h2>
                
                <!-- Formulaire d'ajout/édition -->
                <div class="admin-card">
                    <h3>Ajouter/Modifier un élément</h3>
                    <form id="carousel-form">
                        <input type="hidden" id="carousel-item-id">
                        
                        <div class="form-group">
                            <label for="carousel-type">Type de contenu :</label>
                            <select id="carousel-type" class="form-control" required>
                                <option value="image">Image</option>
                                <option value="video">VidÃ©o</option>
                                <option value="youtube">Lien YouTube</option>
                            </select>
                        </div>

                        <!-- Zone de dÃ©pÃ´t pour les images -->
                        <div id="image-upload-group" class="upload-group">
                            <label>Image :</label>
                            <div id="carousel-dropzone" class="dropzone">
                                <span><i class="fas fa-cloud-upload-alt"></i> Glissez-dÃ©posez une image ici ou cliquez pour sÃ©lectionner</span>
                                <input type="file" id="carousel-image" accept="image/*" style="display: none;">
                            </div>
                            <div id="carousel-preview" class="preview-container"></div>
                        </div>

                        <!-- Zone de dÃ©pÃ´t pour les vidÃ©os -->
                        <div id="video-upload-group" class="upload-group" style="display: none;">
                            <label>VidÃ©o :</label>
                            <div id="video-dropzone" class="dropzone">
                                <span><i class="fas fa-cloud-upload-alt"></i> Glissez-dÃ©posez une vidÃ©o ici ou cliquez pour sÃ©lectionner</span>
                                <input type="file" id="carousel-video" accept="video/*" style="display: none;">
                            </div>
                            <div id="video-preview" class="preview-container"></div>
                        </div>

                        <!-- Champ pour l'URL YouTube -->
                        <div id="youtube-url-group" class="upload-group" style="display: none;">
                            <div class="form-group">
                                <label for="youtube-url">URL YouTube :</label>
                                <input type="url" id="youtube-url" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
                            </div>
                            <div id="youtube-preview" class="preview-container"></div>
                        </div>

                        <div class="form-group">
                            <label for="carousel-title">Titre (optionnel) :</label>
                            <input type="text" id="carousel-title" class="form-control">
                        </div>

                        <div class="form-group">
                            <label for="carousel-description">Description (optionnelle) :</label>
                            <textarea id="carousel-description" class="form-control" rows="2"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="carousel-start-date">Date de dÃ©but :</label>
                                <input type="datetime-local" id="carousel-start-date" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="carousel-end-date">Date de fin (optionnel) :</label>
                                <input type="datetime-local" id="carousel-end-date" class="form-control">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="carousel-link">Lien (optionnel) :</label>
                            <input type="url" id="carousel-link" class="form-control" placeholder="https://exemple.com">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetCarouselForm()">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Liste des Ã©lÃ©ments du carrousel -->
                <div class="admin-card">
                    <h3>Éléments du carrousel</h3>
                    <p class="hint">Glissez-déposez les éléments pour les réorganiser</p>
                    <div id="carousel-items-container" class="sortable-container">
                        <!-- Les Ã©lÃ©ments du carrousel seront ajoutÃ©s ici dynamiquement -->
                    </div>
                </div>
            </div>
            <div id="occasions" class="tab-content">
                <h2>Gestion des Occasions (Matériels et Tracteurs)</h2>
                <div class="admin-card">
                    <h3>Ajouter/Modifier un Matériel/Tracteur</h3>
                    <form id="materiel-type-selector">
                        <label><input type="radio" name="materiel-categorie" value="tracteur" checked> Tracteur</label>
                        <label><input type="radio" name="materiel-categorie" value="materiel"> Autre MatÃ©riel</label>
                    </form>
                    <form id="tracteur-form" style="display: block;">
                        <h4>Formulaire Tracteur</h4>
                        <label for="tracteur-marque">Marque:</label><input type="text" id="tracteur-marque"><br>
                        <label for="tracteur-modele">ModÃ¨le:</label><input type="text" id="tracteur-modele"><br>
                        <label for="tracteur-puissance">Puissance (ch):</label><input type="number" id="tracteur-puissance"><br>
                        <label for="tracteur-boite">BoÃ®te de vitesses:</label><input type="text" id="tracteur-boite"><br>
                        <label for="tracteur-pneus-av">Pneus AV:</label><input type="text" id="tracteur-pneus-av"><br>
                        <label for="tracteur-pneus-ar">Pneus AR:</label><input type="text" id="tracteur-pneus-ar"><br>
                        <label for="tracteur-prix">Prix (â‚¬):</label><input type="number" id="tracteur-prix"><br>
                        <label>Ã‰tat:</label>
                        <label><input type="radio" name="materiel-etat" value="neuf" checked> Neuf</label>
                        <label><input type="radio" name="materiel-etat" value="occasion"> Occasion</label><br>
                        <label><input type="checkbox" id="tracteur-location"> Proposer Ã  la location</label>
                        <div id="tracteur-location-details" style="display:none;">
                            <label for="tracteur-prix-jour">Prix/Jour (â‚¬):</label><input type="number" id="tracteur-prix-jour"><br>
                            <label for="tracteur-prix-semaine">Prix/Semaine (â‚¬):</label><input type="number" id="tracteur-prix-semaine"><br>
                        </div>
                        <label for="tracteur-photos">Photos:</label>
                        <div id="tracteur-dropzone" class="dropzone"><p>Glissez-dÃ©posez des photos ici ou cliquez pour sÃ©lectionner.</p></div>
                        <input type="file" id="tracteur-photos" multiple accept="image/*" style="display:none;">
                        <div id="tracteur-preview" class="preview-container"></div>
                        <button type="button" id="add-tracteur-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter le tracteur</button>
                    </form>
                    <form id="materiel-form" style="display: none;">
                        <h4>Formulaire Autre MatÃ©riel</h4>
                        <label for="materiel-type">Type de matÃ©riel:</label><input type="text" id="materiel-type"><br>
                        <label for="materiel-marque">Marque:</label><input type="text" id="materiel-marque"><br>
                        <label for="materiel-prix">Prix (â‚¬):</label><input type="number" id="materiel-prix"><br>
                        <label>Ã‰tat:</label>
                        <label><input type="radio" name="materiel-etat-autre" value="neuf" checked> Neuf</label>
                        <label><input type="radio" name="materiel-etat-autre" value="occasion"> Occasion</label><br>
                        <label><input type="checkbox" id="materiel-location"> Proposer Ã  la location</label>
                        <div id="materiel-location-details" style="display:none;">
                            <label for="materiel-prix-jour">Prix/Jour (â‚¬):</label><input type="number" id="materiel-prix-jour"><br>
                            <label for="materiel-prix-semaine">Prix/Semaine (â‚¬):</label><input type="number" id="materiel-prix-semaine"><br>
                        </div>
                        <label for="materiel-photos">Photos:</label>
                        <div id="materiel-dropzone" class="dropzone"><p>Glissez-dÃ©posez des photos ici ou cliquez pour sÃ©lectionner.</p></div>
                        <input type="file" id="materiel-photos" multiple accept="image/*" style="display:none;">
                        <div id="materiel-preview" class="preview-container"></div>
                        <button type="button" id="add-materiel-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter le matÃ©riel</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Occasions</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Type</th><th>Marque</th><th>ModÃ¨le/Type</th><th>Ã‰tat</th><th>Prix</th><th>Location</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="occasions-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="promotions" class="tab-content">
                <h2>Gestion des Promotions</h2>
                 <div class="admin-card">
                     <h3>Ajouter/Modifier une Promotion</h3>
                     <form id="promo-form">
                        <label for="promo-title">Titre:</label><input type="text" id="promo-title" required><br>
                        <label for="promo-description">Description:</label><textarea id="promo-description"></textarea><br>
                        <label for="promo-date-debut">Date de dÃ©but:</label><input type="date" id="promo-date-debut" required><br>
                        <label for="promo-date-fin">Date de fin:</label><input type="date" id="promo-date-fin" required><br>
                        <label for="promo-image">Image:</label>
                        <div id="promo-dropzone" class="dropzone"><p>Glissez-dÃ©posez une image ici ou cliquez pour sÃ©lectionner.</p></div>
                        <input type="file" id="promo-image" accept="image/*" style="display:none;">
                        <div id="promo-preview" class="preview-container"></div>
                        <button type="button" id="add-promo-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter la promotion</button>
                     </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Promotions</h3>
                    <table class="admin-table">
                        <thead><tr><th>Titre</th><th>PÃ©riode</th><th>Actions</th></tr></thead>
                        <tbody id="promos-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="contacts" class="tab-content">
                <h2>Gestion des Fiches Contact</h2>
                 <div class="admin-card">
                    <h3>Ajouter/Modifier un Contact</h3>
                    <form id="contact-form">
                        <label for="contact-service">Service:</label>
                        <select id="contact-service" required>
                            <option value="direction">Direction</option><option value="commercial">Commercial</option><option value="atelier">Atelier</option><option value="magasin">Magasin</option><option value="secretariat">SecrÃ©tariat</option>
                        </select><br>
                        <label for="contact-nom">Nom:</label><input type="text" id="contact-nom" required><br>
                        <label for="contact-prenom">PrÃ©nom:</label><input type="text" id="contact-prenom" required><br>
                        <label for="contact-fonction">Fonction:</label><input type="text" id="contact-fonction" required><br>
                        <label for="contact-tel">TÃ©lÃ©phone:</label><input type="tel" id="contact-tel"><br>
                        <label for="contact-email">Email:</label><input type="email" id="contact-email"><br>
                        <button type="button" id="add-contact-btn" class="btn-primary"><i class="fas fa-plus"></i> Ajouter le contact</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Contacts</h3>
                    <table class="admin-table">
                        <thead><tr><th>Service</th><th>Nom PrÃ©nom</th><th>Fonction</th><th>Actions</th></tr></thead>
                        <tbody id="contacts-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    <script>
        // Gestion de la dÃ©connexion
        document.addEventListener('DOMContentLoaded', async function() {
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    try {
                        // DÃ©connexion via Supabase
                        const { error } = await supabase.auth.signOut();
                        if (error) throw error;
                        
                        // Redirection vers la page de connexion aprÃ¨s dÃ©connexion rÃ©ussie
                        window.location.href = 'connexion-prive.html';
                    } catch (error) {
                        console.error('Erreur lors de la dÃ©connexion:', error.message);
                        alert('Une erreur est survenue lors de la dÃ©connexion. Veuillez rÃ©essayer.');
                    }
                });
            }
        });

        // Stockage des donnÃ©es
        const materiels = JSON.parse(localStorage.getItem('franchiniOccasions')) || [];
        let currentEditId = null;
        
        // Gestion du carrousel d'actualitÃ©s
        let carouselItems = JSON.parse(localStorage.getItem('franchiniCarousel')) || [];
        let currentCarouselEditId = null;
        let draggedItem = null;

        // Gestion des actualitÃ©s
        const actualites = JSON.parse(localStorage.getItem('franchiniActualites')) || [];
        let currentActualiteEditId = null;
        const actualitesTableBody = document.getElementById('actualites-table-body');

        // Gestion des onglets
        // Fonction pour extraire l'ID d'une vidÃ©o YouTube
        function extractYoutubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
        
        // Fonction pour formater la date pour l'affichage
        function formatDate(dateString) {
            if (!dateString) return '';
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('fr-FR', options);
        }
        
        // Initialisation de l'interface
        document.addEventListener('DOMContentLoaded', function() {
            // Gestion des onglets
            function initTabs() {
                const tabBtns = document.querySelectorAll('.tab-btn');
                const tabContents = document.querySelectorAll('.tab-content');
                
                // Fonction pour activer un onglet spÃ©cifique
                function activateTab(tabId) {
                    // DÃ©sactiver tous les onglets
                    tabBtns.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Activer l'onglet cliquÃ©
                    const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
                    const activeContent = document.getElementById(tabId);
                    
                    if (activeBtn) activeBtn.classList.add('active');
                    if (activeContent) activeContent.classList.add('active');
                }
                
                // Ajouter les Ã©couteurs d'Ã©vÃ©nements
                tabBtns.forEach(btn => {
                    // Si c'est un lien externe, on ne fait rien de plus
                    if (btn.tagName === 'A') return;
                    
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tabId = btn.getAttribute('data-tab');
                        if (tabId) {
                            activateTab(tabId);
                        }
                    });
                });
                
                // VÃ©rifier si un onglet est spÃ©cifiÃ© dans l'URL
                const urlParams = new URLSearchParams(window.location.search);
                const activeTab = urlParams.get('tab');
                
                if (activeTab && document.getElementById(activeTab)) {
                    // Activer l'onglet spÃ©cifiÃ© dans l'URL
                    activateTab(activeTab);
                } else {
                    // Sinon, activer le premier onglet par dÃ©faut (sauf les liens externes)
                    const firstTab = document.querySelector('.tab-btn:not([href])');
                    if (firstTab) {
                        const tabId = firstTab.getAttribute('data-tab');
                        if (tabId) {
                            activateTab(tabId);
                        }
                    }
                }
            }
            
            // Initialiser les onglets
            initTabs();

            // Gestion des occasions (tracteurs et matÃ©riels)
            const materielTypeRadios = document.querySelectorAll('input[name="materiel-categorie"]');
            const tracteurForm = document.getElementById('tracteur-form');
            const materielForm = document.getElementById('materiel-form');
            
            // Gestion de l'affichage des formulaires de matÃ©riel/tracteur
            materielTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    tracteurForm.style.display = this.value === 'tracteur' ? 'block' : 'none';
                    materielForm.style.display = this.value === 'materiel' ? 'block' : 'none';
                });
            });

            // Gestion de la location pour les tracteurs
            document.getElementById('tracteur-location').addEventListener('change', function() {
                document.getElementById('tracteur-location-details').style.display = this.checked ? 'block' : 'none';
            });

            // Gestion de la location pour le matÃ©riel
            document.getElementById('materiel-location').addEventListener('change', function() {
                document.getElementById('materiel-location-details').style.display = this.checked ? 'block' : 'none';
            });

            // Gestion de l'ajout d'un tracteur
            document.getElementById('add-tracteur-btn').addEventListener('click', function() {
                const etat = document.querySelector('input[name="materiel-etat"]:checked').value;
                const location = document.getElementById('tracteur-location').checked;
                
                const materiel = {
                    id: Date.now(),
                    type: 'tracteur',
                    etat: etat,
                    marque: document.getElementById('tracteur-marque').value,
                    modele: document.getElementById('tracteur-modele').value,
                    puissance: document.getElementById('tracteur-puissance').value,
                    boite: document.getElementById('tracteur-boite').value,
                    pneusAv: document.getElementById('tracteur-pneus-av').value,
                    pneusAr: document.getElementById('tracteur-pneus-ar').value,
                    prix: document.getElementById('tracteur-prix').value,
                    location: location,
                    prixJour: location ? document.getElementById('tracteur-prix-jour').value : null,
                    prixSemaine: location ? document.getElementById('tracteur-prix-semaine').value : null,
                    photos: [] // Ã€ implÃ©menter: gestion des photos
                };

                if (currentEditId) {
                    // Mise Ã  jour d'un matÃ©riel existant
                    const index = materiels.findIndex(m => m.id === currentEditId);
                    if (index !== -1) {
                        materiels[index] = { ...materiel, id: currentEditId };
                    }
                    currentEditId = null;
                    this.innerHTML = '<i class="fas fa-plus"></i> Ajouter le tracteur';
                } else {
                    // Ajout d'un nouveau matÃ©riel
                    materiels.push(materiel);
                }

                updateMaterielsTable();
                resetTracteurForm();
            });

            // Gestion de l'ajout d'un matÃ©riel
            document.getElementById('add-materiel-btn').addEventListener('click', function() {
                const etat = document.querySelector('input[name="materiel-etat-autre"]:checked').value; // Changed name here to avoid conflict
                const location = document.getElementById('materiel-location').checked;
                
                const materiel = {
                    id: Date.now(),
                    type: 'materiel',
                    etat: etat,
                    typeMateriel: document.getElementById('materiel-type').value,
                    marque: document.getElementById('materiel-marque').value,
                    prix: document.getElementById('materiel-prix').value,
                    location: location,
                    prixJour: location ? document.getElementById('materiel-prix-jour').value : null,
                    prixSemaine: location ? document.getElementById('materiel-prix-semaine').value : null,
                    photos: [] // Ã€ implÃ©menter: gestion des photos
                };

                if (currentEditId) {
                    // Mise Ã  jour d'un matÃ©riel existant
                    const index = materiels.findIndex(m => m.id === currentEditId);
                    if (index !== -1) {
                        materiels[index] = { ...materiel, id: currentEditId };
                    }
                    currentEditId = null;
                    this.innerHTML = '<i class="fas fa-plus"></i> Ajouter le matÃ©riel';
                } else {
                    // Ajout d'un nouveau matÃ©riel
                    materiels.push(materiel);
                }

                updateMaterielsTable();
                resetMaterielForm();
            });

            // Fonction pour mettre à jour le tableau des matériels
            function updateMaterielsTable() {
                const tbody = document.getElementById('occasions-table-body');
                tbody.innerHTML = '';

                materiels.forEach(materiel => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${materiel.type === 'tracteur' ? 'Tracteur' : 'MatÃ©riel'}</td>
                        <td>${materiel.marque}</td>
                        <td>${materiel.type === 'tracteur' ? materiel.modele : materiel.typeMateriel}</td>
                        <td>${materiel.etat.charAt(0).toUpperCase() + materiel.etat.slice(1)}</td>
                        <td>${materiel.prix} â‚¬</td>
                        <td>${materiel.location ? 'Oui' : 'Non'}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${materiel.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Supprimer" data-id="${materiel.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Ajout des Ã©couteurs d'Ã©vÃ©nements pour les boutons d'action
                document.querySelectorAll('#occasions-table-body .action-btn.edit').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editMateriel(id);
                    });
                });

                document.querySelectorAll('#occasions-table-body .action-btn.delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteMateriel(id);
                    });
                });

                // Mise Ã  jour des pages concernÃ©es (simulÃ© pour l'instant)
                // updateMaterielDisponiblePage(); 
                // updateOccasionPage();
                // updateLocationPage();
                localStorage.setItem('franchiniOccasions', JSON.stringify(materiels));
            }

            // Fonction pour éditer un matériel
            function editMateriel(id) {
                const materiel = materiels.find(m => m.id === id);
                if (!materiel) return;

                currentEditId = id;

                document.querySelector(`input[name="materiel-categorie"][value="${materiel.type}"]`).checked = true;
                tracteurForm.style.display = materiel.type === 'tracteur' ? 'block' : 'none';
                materielForm.style.display = materiel.type === 'materiel' ? 'block' : 'none';

                if (materiel.type === 'tracteur') {
                    document.querySelector('input[name="materiel-etat"]:checked').value = materiel.etat;
                    document.getElementById('tracteur-marque').value = materiel.marque || '';
                    document.getElementById('tracteur-modele').value = materiel.modele || '';
                    document.getElementById('tracteur-puissance').value = materiel.puissance || '';
                    document.getElementById('tracteur-boite').value = materiel.boite || '';
                    document.getElementById('tracteur-pneus-av').value = materiel.pneusAv || '';
                    document.getElementById('tracteur-pneus-ar').value = materiel.pneusAr || '';
                    document.getElementById('tracteur-prix').value = materiel.prix || '';
                    document.getElementById('tracteur-location').checked = materiel.location || false;
                    document.getElementById('tracteur-location-details').style.display = materiel.location ? 'block' : 'none';
                    document.getElementById('tracteur-prix-jour').value = materiel.prixJour || '';
                    document.getElementById('tracteur-prix-semaine').value = materiel.prixSemaine || '';
                    document.getElementById('add-tracteur-btn').innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                } else {
                    document.querySelector('input[name="materiel-etat-autre"]:checked').value = materiel.etat;
                    document.getElementById('materiel-type').value = materiel.typeMateriel || '';
                    document.getElementById('materiel-marque').value = materiel.marque || '';
                    document.getElementById('materiel-prix').value = materiel.prix || '';
                    document.getElementById('materiel-location').checked = materiel.location || false;
                    document.getElementById('materiel-location-details').style.display = materiel.location ? 'block' : 'none';
                    document.getElementById('materiel-prix-jour').value = materiel.prixJour || '';
                    document.getElementById('materiel-prix-semaine').value = materiel.prixSemaine || '';
                    document.getElementById('add-materiel-btn').innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                }
                document.querySelector('#occasions .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deleteMateriel(id) {
                if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer ce matÃ©riel ?')) {
                    const index = materiels.findIndex(m => m.id === id);
                    if (index !== -1) {
                        materiels.splice(index, 1);
                        localStorage.setItem('franchiniOccasions', JSON.stringify(materiels));
                        updateMaterielsTable();
                    }
                }
            }

            function resetTracteurForm() {
                document.getElementById('tracteur-form').reset();
                document.getElementById('tracteur-location-details').style.display = 'none';
                document.getElementById('tracteur-preview').innerHTML = '';
                document.getElementById('add-tracteur-btn').innerHTML = '<i class="fas fa-plus"></i> Ajouter le tracteur';
                currentEditId = null;
            }

            function resetMaterielForm() {
                document.getElementById('materiel-form').reset();
                document.getElementById('materiel-location-details').style.display = 'none';
                document.getElementById('materiel-preview').innerHTML = '';
                document.getElementById('add-materiel-btn').innerHTML = '<i class="fas fa-plus"></i> Ajouter le matÃ©riel';
                currentEditId = null;
            }

            // Gestion des promotions
            const addPromoBtn = document.getElementById('add-promo-btn');
            const promosTableBody = document.getElementById('promos-table-body');
            const promos = JSON.parse(localStorage.getItem('franchiniPromos')) || []; // Stockage pour les promotions
            let currentPromoEditId = null;

            if (addPromoBtn) {
                addPromoBtn.addEventListener('click', function() {
                    const title = document.getElementById('promo-title').value;
                    const description = document.getElementById('promo-description').value;
                    const dateDebut = document.getElementById('promo-date-debut').value;
                    const dateFin = document.getElementById('promo-date-fin').value;
                    // const image = document.getElementById('promo-image').files[0]; // Gestion d'image Ã  affiner

                    if (title && dateDebut && dateFin) {
                        const promo = { id: currentPromoEditId || Date.now(), title, description, dateDebut, dateFin }; //, imageName: image ? image.name : null };
                        if (currentPromoEditId) {
                            const index = promos.findIndex(p => p.id === currentPromoEditId);
                            promos[index] = promo;
                        } else {
                            promos.push(promo);
                        }
                        localStorage.setItem('franchiniPromos', JSON.stringify(promos));
                        updatePromosTable();
                        resetPromoForm();
                    } else {
                        alert('Veuillez remplir tous les champs obligatoires pour la promotion.');
                    }
                });
            }

            function updatePromosTable() {
                promosTableBody.innerHTML = '';
                promos.forEach(promo => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${promo.title}</td>
                        <td>${formatDate(promo.dateDebut)} - ${formatDate(promo.dateFin)}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${promo.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete" title="Supprimer" data-id="${promo.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    `;
                    promosTableBody.appendChild(tr);
                });
                // Add event listeners for new buttons
                document.querySelectorAll('#promos-table-body .action-btn.edit').forEach(btn => btn.addEventListener('click', e => editPromo(parseInt(e.currentTarget.dataset.id))));
                document.querySelectorAll('#promos-table-body .action-btn.delete').forEach(btn => btn.addEventListener('click', e => deletePromo(parseInt(e.currentTarget.dataset.id))));
            }
            
            function resetPromoForm() {
                document.getElementById('promo-form').reset();
                document.getElementById('promo-preview').innerHTML = '';
                addPromoBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter la promotion';
                currentPromoEditId = null;
            }

            function editPromo(id) {
                const promo = promos.find(p => p.id === id);
                if (!promo) return;
                currentPromoEditId = id;
                document.getElementById('promo-title').value = promo.title;
                document.getElementById('promo-description').value = promo.description;
                document.getElementById('promo-date-debut').value = promo.dateDebut;
                document.getElementById('promo-date-fin').value = promo.dateFin;
                addPromoBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                document.querySelector('#promotions .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deletePromo(id) {
                if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cette promotion ?')) {
                    const index = promos.findIndex(p => p.id === id);
                    if (index !== -1) {
                        promos.splice(index, 1);
                        localStorage.setItem('franchiniPromos', JSON.stringify(promos));
                        updatePromosTable();
                    }
                }
            }

            // Gestion des contacts
            const addContactBtn = document.getElementById('add-contact-btn');
            const contactsTableBody = document.getElementById('contacts-table-body');
            const contacts = JSON.parse(localStorage.getItem('franchiniContacts')) || []; // Stockage pour les contacts
            let currentContactEditId = null;

            if (addContactBtn) {
                addContactBtn.addEventListener('click', function() {
                    const service = document.getElementById('contact-service').value;
                    const nom = document.getElementById('contact-nom').value;
                    const prenom = document.getElementById('contact-prenom').value;
                    const fonction = document.getElementById('contact-fonction').value;
                    const tel = document.getElementById('contact-tel').value;
                    const email = document.getElementById('contact-email').value;

                    if (service && nom && prenom && fonction) {
                        const contact = { id: currentContactEditId || Date.now(), service, nom, prenom, fonction, tel, email };
                        if (currentContactEditId) {
                            const index = contacts.findIndex(c => c.id === currentContactEditId);
                            contacts[index] = contact;
                        } else {
                            contacts.push(contact);
                        }
                        localStorage.setItem('franchiniContacts', JSON.stringify(contacts));
                        updateContactsTable();
                        resetContactForm();
                    } else {
                        alert('Veuillez remplir les champs Service, Nom, PrÃ©nom et Fonction.');
                    }
                });
            }

            function updateContactsTable() {
                contactsTableBody.innerHTML = '';
                contacts.forEach(contact => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${contact.service.charAt(0).toUpperCase() + contact.service.slice(1)}</td>
                        <td>${contact.nom} ${contact.prenom}</td>
                        <td>${contact.fonction}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${contact.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete" title="Supprimer" data-id="${contact.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    `;
                    contactsTableBody.appendChild(tr);
                });
                document.querySelectorAll('#contacts-table-body .action-btn.edit').forEach(btn => btn.addEventListener('click', e => editContact(parseInt(e.currentTarget.dataset.id))));
                document.querySelectorAll('#contacts-table-body .action-btn.delete').forEach(btn => btn.addEventListener('click', e => deleteContact(parseInt(e.currentTarget.dataset.id))));
            }

            function resetContactForm() {
                document.getElementById('contact-form').reset();
                addContactBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter le contact';
                currentContactEditId = null;
            }

            function editContact(id) {
                const contact = contacts.find(c => c.id === id);
                if (!contact) return;
                currentContactEditId = id;
                document.getElementById('contact-service').value = contact.service;
                document.getElementById('contact-nom').value = contact.nom;
                document.getElementById('contact-prenom').value = contact.prenom;
                document.getElementById('contact-fonction').value = contact.fonction;
                document.getElementById('contact-tel').value = contact.tel;
                document.getElementById('contact-email').value = contact.email;
                addContactBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                document.querySelector('#contacts .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deleteContact(id) {
                if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer ce contact ?')) {
                    const index = contacts.findIndex(c => c.id === id);
                    if (index !== -1) {
                        contacts.splice(index, 1);
                        localStorage.setItem('franchiniContacts', JSON.stringify(contacts));
                        updateContactsTable();
                    }
                }
            }
            
            // Fonction utilitaire pour empêcher le comportement par défaut
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Fonction pour extraire l'ID d'une vidÃ©o YouTube
            function extractYoutubeId(url) {
                const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
                const match = (url + '').match(regExp);
                return (match && match[7].length === 11) ? match[7] : null;
            }

            // Fonction générique pour configurer une zone de dépôt
            function setupDropzone(dropzoneId, fileInputId, previewContainerId) {
                console.log('Initialisation de la zone de dÃ©pÃ´t:', dropzoneId, fileInputId, previewContainerId);
                
                const dropzone = document.getElementById(dropzoneId);
                const fileInput = document.getElementById(fileInputId);
                const previewContainer = document.getElementById(previewContainerId);
                
                if (!dropzone) {
                    console.error('Zone de dÃ©pÃ´t non trouvÃ©e:', dropzoneId);
                    return;
                }
                
                if (!fileInput) {
                    console.error('Input fichier non trouvÃ©:', fileInputId);
                    return;
                }
                
                console.log('Ã‰lÃ©ments trouvÃ©s, configuration des Ã©vÃ©nements...');
                
                // Fonction pour empÃªcher le comportement par dÃ©faut
                const preventDefaults = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                };
                
                // Fonction pour mettre en surbrillance la zone de dÃ©pÃ´t
                const highlight = (e) => {
                    dropzone.classList.add('highlight');
                };
                
                // Fonction pour retirer la surbrillance
                const unhighlight = (e) => {
                    dropzone.classList.remove('highlight');
                };
                
                // GÃ©rer le dÃ©pÃ´t de fichiers
                const handleDrop = (e) => {
                    console.log('Fichier(s) dÃ©posÃ©(s)');
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    
                    if (files.length > 0) {
                        console.log('Fichier dÃ©tectÃ©:', files[0].name);
                        handleFiles(files, false, previewContainer);
                        // Mettre Ã  jour l'input file avec les fichiers dÃ©posÃ©s
                        fileInput.files = files;
                    }
                };
                
                // GÃ©rer le clic sur la zone de dÃ©pÃ´t
                const handleClick = () => {
                    console.log('Clic sur la zone de dÃ©pÃ´t');
                    fileInput.click();
                };
                
                // GÃ©rer la sÃ©lection de fichiers via l'input
                const handleFileSelect = (e) => {
                    console.log('Fichier sÃ©lectionnÃ© via input');
                    if (this.files && this.files.length > 0) {
                        console.log('Fichier sÃ©lectionnÃ©:', this.files[0].name);
                        handleFiles(this.files, false, previewContainer);
                    }
                };
                
                // Ajouter les Ã©couteurs d'Ã©vÃ©nements
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });
                
                // Mettre en surbrillance la zone de dÃ©pÃ´t
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropzone.addEventListener(eventName, highlight, false);
                });
                
                // Retirer la surbrillance
                ['dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, unhighlight, false);
                });
                
                // GÃ©rer le dÃ©pÃ´t de fichiers
                dropzone.addEventListener('drop', handleDrop, false);
                
                // GÃ©rer le clic sur la zone de dÃ©pÃ´t
                dropzone.addEventListener('click', handleClick, false);
                
                // GÃ©rer la sÃ©lection de fichiers via l'input
                fileInput.addEventListener('change', handleFileSelect, false);
                
                console.log('Configuration de la zone de dÃ©pÃ´t terminÃ©e');
            }
            
            // Fonction pour initialiser toutes les zones de dépôt
            function initializeAllDropzones() {
                console.log('Initialisation des zones de dÃ©pÃ´t...');
                
                // VÃ©rifier si les Ã©lÃ©ments de la page sont chargÃ©s
                const mediaDropzone = document.getElementById('media-dropzone');
                const mediaUpload = document.getElementById('media-upload');
                
                if (!mediaDropzone || !mediaUpload) {
                    console.error('Ã‰lÃ©ments de la zone de dÃ©pÃ´t non trouvÃ©s, rÃ©essai dans 100ms...');
                    setTimeout(initializeAllDropzones, 100);
                    return;
                }
                
                console.log('Ã‰lÃ©ments de la zone de dÃ©pÃ´t trouvÃ©s, configuration en cours...');
                
                // Zones de dÃ©pÃ´t principales
                setupDropzone('tracteur-dropzone', 'tracteur-photos', 'tracteur-preview');
                setupDropzone('materiel-dropzone', 'materiel-photos', 'materiel-preview');
                setupDropzone('promo-dropzone', 'promo-image', 'promo-preview');
                
                // Zones de dÃ©pÃ´t du carrousel
                setupDropzone('media-dropzone', 'media-upload', 'media-preview');
                setupDropzone('carousel-dropzone', 'carousel-image', 'carousel-preview');
                setupDropzone('video-dropzone', 'carousel-video', 'video-preview');
                
                // Ajouter un style pour indiquer que la zone est cliquable
                const dropzones = document.querySelectorAll('.dropzone');
                dropzones.forEach(dz => {
                    dz.style.cursor = 'pointer';
                    dz.style.transition = 'all 0.3s ease';
                    dz.style.position = 'relative';
                    
                    // Ajouter un effet visuel au survol
                    dz.addEventListener('mouseenter', () => {
                        dz.style.borderColor = '#666';
                        dz.style.backgroundColor = '#f0f0f0';
                    });
                    
                    dz.addEventListener('mouseleave', () => {
                        dz.style.borderColor = '#aaa';
                        dz.style.backgroundColor = '#f8f9fa';
                    });
                });
                
                console.log('Toutes les zones de dÃ©pÃ´t ont Ã©tÃ© initialisÃ©es');
            }
            
            // Démarrer l'initialisation lorsque le DOM est chargé
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeAllDropzones);
            } else {
                // Le DOM est dÃ©jÃ  chargÃ©
                initializeAllDropzones();
            }
            
            // Solution simplifiÃ©e pour la zone de dÃ©pÃ´t
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DÃ©marrage de la configuration de la zone de dÃ©pÃ´t...');
                
                // RÃ©cupÃ©rer les Ã©lÃ©ments
                const dropzone = document.querySelector('.dropzone');
                const fileInput = document.querySelector('input[type="file"]');
                const previewContainer = document.getElementById('media-preview');
                
                if (!dropzone || !fileInput) {
                    console.error('Ã‰lÃ©ments non trouvÃ©s:', { dropzone: !!dropzone, fileInput: !!fileInput });
                    return;
                }
                
                console.log('Ã‰lÃ©ments trouvÃ©s, configuration en cours...');
                
                // Style de base pour la zone de dÃ©pÃ´t
                Object.assign(dropzone.style, {
                    cursor: 'pointer',
                    border: '2px dashed #007bff',
                    padding: '20px',
                    textAlign: 'center',
                    borderRadius: '5px',
                    backgroundColor: '#f8f9fa',
                    margin: '10px 0',
                    transition: 'all 0.3s ease'
                });
                
                // Gestionnaire de clic direct
                dropzone.addEventListener('click', function(e) {
                    console.log('Clic dÃ©tectÃ© sur la zone de dÃ©pÃ´t');
                    e.stopPropagation();
                    fileInput.click();
                }, false);
                
                // Gestionnaire de changement de fichier
                fileInput.addEventListener('change', function(e) {
                    console.log('Changement de fichier dÃ©tectÃ©');
                    if (this.files && this.files.length > 0) {
                        console.log('Fichier sÃ©lectionnÃ©:', this.files[0].name);
                        handleFiles(this.files, false, previewContainer);
                    }
                }, false);
                
                // Gestion du glisser-dÃ©poser
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }, false);
                });
                
                // Effet visuel au survol
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropzone.addEventListener(eventName, function() {
                        this.style.borderColor = '#28a745';
                        this.style.backgroundColor = '#e8f5e9';
                    }, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, function() {
                        this.style.borderColor = '#007bff';
                        this.style.backgroundColor = '#f8f9fa';
                    }, false);
                });
                
                // Gestion du dÃ©pÃ´t de fichier
                dropzone.addEventListener('drop', function(e) {
                    console.log('Fichier dÃ©posÃ©');
                    const files = e.dataTransfer.files;
                    if (files.length) {
                        console.log('Fichier dÃ©posÃ© dÃ©tectÃ©:', files[0].name);
                        handleFiles(files, false, previewContainer);
                        fileInput.files = files;
                    }
                }, false);
                
                console.log('Configuration de la zone de dÃ©pÃ´t terminÃ©e avec succÃ¨s');
            });
            
            // Gestion du carrousel d'accueil
            let carouselItems = [];
            try {
                const carouselData = localStorage.getItem('franchiniCarousel');
                console.log('DonnÃ©es brutes du localStorage:', carouselData);
                
                if (carouselData) {
                    carouselItems = JSON.parse(carouselData);
                    console.log('Ã‰lÃ©ments du carrousel chargÃ©s:', carouselItems);
                } else {
                    console.log('Aucune donnÃ©e de carrousel trouvÃ©e dans le localStorage');
                }
            } catch (error) {
                console.error('Erreur lors du chargement du carrousel depuis le localStorage:', error);
                carouselItems = [];
            }
            
            let currentEditId = null;
            
            // Ã‰lÃ©ments du formulaire
            const mediaTypeSelect = document.getElementById('media-type');
            const imageUploadSection = document.getElementById('image-upload-section');
            const youtubeSection = document.getElementById('youtube-section');
            const mediaUpload = document.getElementById('media-upload');
            const mediaPreview = document.getElementById('media-preview');
            const youtubeUrl = document.getElementById('youtube-url');
            const mediaTitle = document.getElementById('media-title');
            const mediaDescription = document.getElementById('media-description');
            const mediaLink = document.getElementById('media-link');
            const linkText = document.getElementById('link-text');
            const addMediaBtn = document.getElementById('add-media-btn');
            const carouselItemsContainer = document.getElementById('carousel-items');
            
            // Gestion du changement d'URL YouTube
            const youtubeUrlElement = document.getElementById('youtube-url');
            const mediaPreviewElement = document.getElementById('media-preview');
            
            if (youtubeUrlElement) {
                youtubeUrlElement.addEventListener('input', function() {
                    const previewContainer = document.getElementById('youtube-preview') || mediaPreviewElement;
                    
                    // VÃ©rifier si l'URL est une URL YouTube valide
                    if (this.value && (this.value.includes('youtube.com/') || this.value.includes('youtu.be/'))) {
                        const youtubeId = extractYoutubeId(this.value);
                        if (youtubeId) {
                            // Afficher l'aperÃ§u de la vidÃ©o YouTube
                            handleFiles([this.value], true, previewContainer);
                            // Activer le bouton d'ajout
                            if (addMediaBtn) {
                                addMediaBtn.disabled = false;
                            }
                        } else {
                            // Afficher un message d'erreur
                            if (previewContainer) {
                                previewContainer.innerHTML = `
                                    <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                        <i class="fas fa-exclamation-triangle"></i> URL YouTube invalide. Veuillez vÃ©rifier le lien.
                                    </div>
                                `;
                            }
                            // DÃ©sactiver le bouton d'ajout si l'URL n'est pas valide
                            if (addMediaBtn) {
                                addMediaBtn.disabled = true;
                            }
                        }
                    } else if (this.value === '') {
                        // Si le champ est vide, effacer l'aperÃ§u et dÃ©sactiver le bouton d'ajout
                        if (previewContainer) {
                            previewContainer.innerHTML = '';
                        }
                        if (addMediaBtn) {
                            addMediaBtn.disabled = true;
                        }
                    }
                });
            }
            
            // Basculer entre les types de mÃ©dias
            if (mediaTypeSelect) {
                mediaTypeSelect.addEventListener('change', function() {
                    if (!imageUploadSection || !youtubeSection) return;
                    
                    if (this.value === 'image') {
                        imageUploadSection.style.display = 'block';
                        youtubeSection.style.display = 'none';
                    } else {
                        imageUploadSection.style.display = 'none';
                        youtubeSection.style.display = 'block';
                    }
                });
            }
            
            // Initialiser l'Ã©tat initial des sections
            if (mediaTypeSelect && imageUploadSection && youtubeSection) {
                if (mediaTypeSelect.value === 'image') {
                    imageUploadSection.style.display = 'block';
                    youtubeSection.style.display = 'none';
                } else {
                    imageUploadSection.style.display = 'none';
                    youtubeSection.style.display = 'block';
                }
            }
            
            function handleFiles(files, isYoutubeUrl = false, previewContainer = null) {
                if (!files || files.length === 0) return;
                
                const file = files[0];
                if (!file) return;
                
                // Utiliser le conteneur d'aperÃ§u fourni ou essayer de trouver un conteneur par dÃ©faut
                const targetPreview = previewContainer || document.getElementById('media-preview');
                
                // Si aucun conteneur n'est trouvÃ©, afficher une erreur
                if (!targetPreview) {
                    console.error('Aucun conteneur d\'aperÃ§u trouvÃ©');
                    return;
                }
                
                // VÃ©rifier si c'est une URL YouTube
                if (isYoutubeUrl) {
                    const youtubeId = extractYoutubeId(file);
                    if (!youtubeId) {
                        if (targetPreview) {
                            targetPreview.innerHTML = `
                                <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                    <i class="fas fa-exclamation-triangle"></i> URL YouTube invalide. Veuillez vÃ©rifier le lien.
                                </div>
                            `;
                        }
                        return;
                    }
                    
                    // Afficher l'aperÃ§u de la vidÃ©o YouTube
                    if (targetPreview) {
                        targetPreview.innerHTML = `
                            <div class="youtube-preview" style="margin-top: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; text-align: center;">
                                <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 10px; background: #000;">
                                    <img src="https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg" 
                                         alt="Miniature YouTube" 
                                         style="width: 100%; height: auto; opacity: 0.8;"
                                         onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                        <div style="width: 68px; height: 48px; background: #ff0000; border-radius: 20%; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="this.parentNode.parentNode.parentNode.querySelector('iframe').style.display='block'; this.parentNode.parentNode.style.display='none';">
                                            <i class="fas fa-play" style="color: white; font-size: 20px; margin-left: 4px;"></i>
                                        </div>
                                    </div>
                                    <iframe id="ytplayer" type="text/html" width="100%" height="100%"
                                        src="https://www.youtube.com/embed/${youtubeId}?enablejsapi=1&origin=${window.location.origin}"
                                        frameborder="0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none;"></iframe>
                                </div>
                                <div style="font-size: 14px; color: #333; margin-bottom: 10px; text-align: left;">
                                    <div><strong>Type :</strong> VidÃ©o YouTube</div>
                                    <div><strong>URL :</strong> ${file}</div>
                                </div>
                                <button type="button" class="remove-media-btn" style="background: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; font-size: 13px; display: flex; align-items: center; margin: 0 auto;">
                                    <i class="fas fa-times" style="margin-right: 5px;"></i> Supprimer la vidÃ©o
                                </button>
                            </div>
                        `;
                        
                        // Ajouter un Ã©couteur d'Ã©vÃ©nement pour le bouton de suppression
                        const removeBtn = targetPreview.querySelector('.remove-media-btn');
                        if (removeBtn) {
                            removeBtn.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                targetPreview.innerHTML = '';
                                if (youtubeUrl) {
                                    youtubeUrl.value = '';
                                }
                            });
                        }
                    }
                    return;
                }
                
                // VÃ©rifier le type de fichier pour les images
                if (!file.type.startsWith('image/')) {
                    if (targetPreview) {
                        targetPreview.innerHTML = `
                            <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Format de fichier non supportÃ©. Veuillez utiliser une image (JPG, PNG, etc.) ou une URL YouTube.
                            </div>
                        `;
                    }
                    return;
                }
                
                // VÃ©rifier la taille du fichier (max 5MB)
                const maxSize = 5 * 1024 * 1024; // 5MB
                if (file.size > maxSize) {
                    if (targetPreview) {
                        targetPreview.innerHTML = `
                            <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Le fichier est trop volumineux (${Math.round(file.size / (1024 * 1024) * 10) / 10} MB). La taille maximale est de 5MB.
                            </div>
                        `;
                    }
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (!targetPreview) return;
                    
                    // CrÃ©er un conteneur pour l'aperÃ§u avec un bouton de suppression
                    targetPreview.innerHTML = `
                        <div class="media-preview-container" style="position: relative; display: inline-block; margin-top: 10px; width: 100%; max-width: 500px;">
                            <div style="position: relative; border: 1px solid #dee2e6; border-radius: 4px; overflow: hidden; background: #f8f9fa;">
                                <img src="${e.target.result}" 
                                 alt="AperÃ§u" 
                                 style="max-width: 100%; max-height: 300px; display: block; margin: 0 auto;"
                                 onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">
                                <button type="button" class="remove-media-btn" style="position: absolute; top: 10px; right: 10px; background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 14px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div style="font-size: 13px; color: #666; margin-top: 8px; text-align: left; padding: 0 5px;">
                                <div><strong>Nom :</strong> ${file.name}</div>
                                <div><strong>Taille :</strong> ${(file.size / 1024).toFixed(1)} KB</div>
                                <div><strong>Type :</strong> ${file.type}</div>
                            </div>
                        </div>
                    `;
                    
                    // Ajouter un Ã©couteur d'Ã©vÃ©nement pour le bouton de suppression
                    const removeBtn = targetPreview.querySelector('.remove-media-btn');
                    if (removeBtn) {
                        removeBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            targetPreview.innerHTML = '';
                            if (fileInput) {
                                fileInput.value = '';
                            }
                        });
                    }
                };
                
                reader.onerror = function() {
                    if (targetPreview) {
                        targetPreview.innerHTML = `
                            <div style="color: #dc3545; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Erreur lors de la lecture du fichier. Veuillez rÃ©essayer avec une autre image.
                            </div>
                        `;
                    }
                };
                
                reader.readAsDataURL(file);
            }
            
            // Ajouter un Ã©lÃ©ment au carrousel
            if (addMediaBtn) {
                addMediaBtn.addEventListener('click', function() {
                    try {
                        // DÃ©sactiver le bouton pour Ã©viter les clics multiples
                        addMediaBtn.disabled = true;
                        addMediaBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement en cours...';
                        
                        const type = mediaTypeSelect ? mediaTypeSelect.value : 'image';
                        
                        if (type === 'image') {
                            // VÃ©rifier si un fichier a Ã©tÃ© sÃ©lectionnÃ© via l'input file
                            if (mediaUpload && mediaUpload.files && mediaUpload.files.length > 0) {
                                const file = mediaUpload.files[0];
                                
                                // VÃ©rifier la taille du fichier (max 5MB)
                                const maxSize = 5 * 1024 * 1024; // 5MB
                                if (file.size > maxSize) {
                                    alert('Le fichier est trop volumineux. La taille maximale est de 5MB.');
                                    addMediaBtn.disabled = false;
                                    addMediaBtn.innerHTML = currentEditId ? 
                                        '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                        '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                    return;
                                }
                                
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    try {
                                        const mediaUrl = e.target.result;
                                        addCarouselItem(type, mediaUrl);
                                    } catch (error) {
                                        console.error('Erreur lors du traitement de l\'image:', error);
                                        alert('Une erreur est survenue lors du traitement de l\'image. Veuillez rÃ©essayer.');
                                        addMediaBtn.disabled = false;
                                        addMediaBtn.innerHTML = currentEditId ? 
                                            '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                            '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                    }
                                };
                                
                                reader.onerror = function() {
                                    alert('Erreur lors de la lecture du fichier. Veuillez rÃ©essayer avec une autre image.');
                                    addMediaBtn.disabled = false;
                                    addMediaBtn.innerHTML = currentEditId ? 
                                        '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                        '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                };
                                
                                reader.readAsDataURL(file);
                                return; // On sort de la fonction ici, le reste sera gÃ©rÃ© dans le callback
                            } 
                            // Vérifier si une image est déjà affichée dans la prévisualisation (pour l'édition)
                            else if (mediaPreview && mediaPreview.querySelector('img') && currentEditId) {
                                const imgSrc = mediaPreview.querySelector('img').src;
                                if (imgSrc && imgSrc.startsWith('data:image/')) {
                                    addCarouselItem(type, imgSrc);
                                    return;
                                }
                            } 
                            else {
                                alert('Veuvez sÃ©lectionner une image Ã  tÃ©lÃ©verser');
                                addMediaBtn.disabled = false;
                                addMediaBtn.innerHTML = currentEditId ? 
                                    '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                    '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                return;
                            }
                        } else {
                            // Pour les vidÃ©os YouTube
                            const youtubeId = youtubeUrl ? extractYoutubeId(youtubeUrl.value.trim()) : null;
                            if (!youtubeId) {
                                alert('URL YouTube invalide. Veuillez entrer une URL YouTube valide.');
                                addMediaBtn.disabled = false;
                                addMediaBtn.innerHTML = currentEditId ? 
                                    '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                                    '<i class="fas fa-plus"></i> Ajouter au carrousel';
                                return;
                            }
                            
                            const mediaUrl = `https://www.youtube.com/embed/${youtubeId}`;
                            addCarouselItem(type, mediaUrl);
                        }
                    } catch (error) {
                        console.error('Erreur inattendue:', error);
                        alert('Une erreur inattendue est survenue. Veuillez rÃ©essayer.');
                        addMediaBtn.disabled = false;
                        addMediaBtn.innerHTML = currentEditId ? 
                            '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                            '<i class="fas fa-plus"></i> Ajouter au carrousel';
                    }
                });
            }
            
            // Fonction pour ajouter un élément au carrousel
            function addCarouselItem(type, mediaUrl) {
                try {
                    if (!mediaUrl) {
                        console.error('Aucune URL de mÃ©dia fournie');
                        return;
                    }
                    
                    // VÃ©rifier si c'est une URL YouTube valide pour le type vidÃ©o
                    if (type === 'youtube') {
                        const youtubeId = extractYoutubeId(mediaUrl);
                        if (!youtubeId) {
                            alert('URL YouTube invalide. Veuillez vÃ©rifier le lien.');
                            return;
                        }
                        mediaUrl = `https://www.youtube.com/embed/${youtubeId}`;
                    } else if (type === 'image' && !mediaUrl.startsWith('data:image/')) {
                        // VÃ©rifier si c'est une image valide (format base64 ou URL)
                        console.error('Format d\'image non valide');
                        return;
                    }
                    
                    const item = {
                        id: currentEditId || Date.now(),
                        type: type,
                        url: mediaUrl,
                        title: mediaTitle ? mediaTitle.value.trim() : '',
                        description: mediaDescription ? mediaDescription.value.trim() : '',
                        link: mediaLink ? mediaLink.value.trim() : '',
                        linkText: linkText ? (linkText.value.trim() || 'Voir plus') : 'Voir plus',
                        order: currentEditId ? carouselItems.find(item => item.id === currentEditId)?.order || carouselItems.length : carouselItems.length,
                        createdAt: new Date().toISOString()
                    };
                    
                    if (currentEditId) {
                        // Mise Ã  jour d'un Ã©lÃ©ment existant
                        const index = carouselItems.findIndex(item => item.id === currentEditId);
                        if (index !== -1) {
                            // PrÃ©server la date de crÃ©ation originale
                            item.createdAt = carouselItems[index].createdAt;
                            carouselItems[index] = item;
                            console.log('Ã‰lÃ©ment mis Ã  jour avec succÃ¨s:', item);
                        }
                        currentEditId = null;
                        if (addMediaBtn) {
                            addMediaBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter au carrousel';
                            addMediaBtn.disabled = false;
                        }
                    } else {
                        // Ajout d'un nouvel Ã©lÃ©ment
                        carouselItems.push(item);
                        console.log('Nouvel Ã©lÃ©ment ajoutÃ© avec succÃ¨s:', item);
                    }
                    
                    saveCarousel();
                    updateCarouselDisplay();
                    resetForm();
                    
                    // Afficher un message de succÃ¨s
                    const successMessage = document.createElement('div');
                    successMessage.className = 'alert alert-success';
                    successMessage.style.marginTop = '10px';
                    successMessage.style.padding = '10px';
                    successMessage.style.borderRadius = '4px';
                    successMessage.style.backgroundColor = '#d4edda';
                    successMessage.style.color = '#155724';
                    successMessage.style.border = '1px solid #c3e6cb';
                    successMessage.textContent = currentEditId ? 'Ã‰lÃ©ment mis Ã  jour avec succÃ¨s !' : 'Ã‰lÃ©ment ajoutÃ© avec succÃ¨s !';
                    
                    const formCard = document.querySelector('#accueil .admin-card');
                    if (formCard) {
                        formCard.appendChild(successMessage);
                        // Supprimer le message aprÃ¨s 3 secondes
                        setTimeout(() => {
                            if (successMessage.parentNode === formCard) {
                                formCard.removeChild(successMessage);
                            }
                        }, 3000);
                    }
                } catch (error) {
                    console.error('Erreur lors de l\'ajout de l\'Ã©lÃ©ment au carrousel:', error);
                    alert('Une erreur est survenue lors de l\'ajout de l\'Ã©lÃ©ment. Veuillez rÃ©essayer.');
                    
                    if (addMediaBtn) {
                        addMediaBtn.disabled = false;
                        addMediaBtn.innerHTML = currentEditId ? 
                            '<i class="fas fa-save"></i> Enregistrer les modifications' : 
                            '<i class="fas fa-plus"></i> Ajouter au carrousel';
                    }
                }
            }
            
            // Extraire l'ID d'une URL YouTube
            function extractYoutubeId(url) {
                if (!url) return null;
                
                // Nettoyer l'URL des paramÃ¨tres supplÃ©mentaires
                url = url.trim();
                
                // Gestion des URLs courtes youtu.be
                if (url.includes('youtu.be/')) {
                    const id = url.split('youtu.be/')[1];
                    return id ? id.split(/[?&#]/)[0] : null;
                }
                
                // Gestion des URLs complÃ¨tes
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                
                if (match && match[2]) {
                    // Extraire l'ID et nettoyer les paramÃ¨tres supplÃ©mentaires
                    const id = match[2].split(/[?&#]/)[0];
                    return id.length === 11 ? id : null;
                }
                
                return null;
            }
            
            // Mettre Ã  jour l'affichage du carrousel
            function updateCarouselDisplay() {
                console.log('DÃ©but de updateCarouselDisplay');
                console.log('carouselItems:', carouselItems);
                
                // S'assurer que le conteneur existe
                carouselItemsContainer = document.getElementById('carousel-items');
                
                if (!carouselItemsContainer) {
                    console.error('Erreur: carouselItemsContainer non trouvÃ©');
                    return;
                }
                
                console.log('Conteneur carouselItemsContainer trouvÃ©:', carouselItemsContainer);
                
                console.log('Vidage du conteneur carouselItemsContainer');
                carouselItemsContainer.innerHTML = '';
                
                // Trier les Ã©lÃ©ments par ordre
                console.log('Tri des Ã©lÃ©ments du carrousel');
                const sortedItems = [...carouselItems].sort((a, b) => a.order - b.order);
                console.log('Ã‰lÃ©ments triÃ©s:', sortedItems);
                
                sortedItems.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'carousel-item';
                    itemElement.draggable = true;
                    itemElement.dataset.id = item.id;
                    
                    let mediaContent = '';
                    if (item.type === 'image') {
                        mediaContent = `<img src="${item.url}" 
                                          alt="${item.title || 'Image du carrousel'}"
                                          onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">`;
                    } else {
                        mediaContent = `<iframe src="${item.url}" frameborder="0" allowfullscreen></iframe>`;
                    }
                    
                    itemElement.innerHTML = `
                        <div class="carousel-item-preview">
                            ${mediaContent}
                        </div>
                        <div class="carousel-item-details">
                            ${item.title ? `<h4>${item.title}</h4>` : ''}
                            ${item.description ? `<p>${item.description}</p>` : ''}
                            ${item.link ? `<a href="${item.link}" class="carousel-item-link" target="_blank">${item.linkText}</a>` : ''}
                            <div class="carousel-item-actions">
                                <div class="carousel-item-buttons">
                                    <button class="edit-item" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-item" title="Supprimer">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <div class="drag-handle" title="DÃ©placer">
                                    <i class="fas fa-arrows-alt"></i>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Ajouter les gestionnaires d'Ã©vÃ©nements
                    const editBtn = itemElement.querySelector('.edit-item');
                    const deleteBtn = itemElement.querySelector('.delete-item');
                    const dragHandle = itemElement.querySelector('.drag-handle');
                    
                    editBtn.addEventListener('click', () => editCarouselItem(item.id));
                    deleteBtn.addEventListener('click', () => deleteCarouselItem(item.id));
                    
                    // Ajouter les gestionnaires d'Ã©vÃ©nements pour le glisser-dÃ©poser
                    if (itemElement) {
                        itemElement.addEventListener('dragstart', handleDragStart);
                        itemElement.addEventListener('dragover', handleDragOver);
                        itemElement.addEventListener('drop', handleDrop);
                        itemElement.addEventListener('dragend', handleDragEnd);
                        itemElement.addEventListener('dragleave', function() {
                            this.classList.remove('drag-over');
                        });
                    }
                    
                    console.log('Ajout de l\'Ã©lÃ©ment au DOM:', item);
                    carouselItemsContainer.appendChild(itemElement);
                    console.log('Ã‰lÃ©ment ajoutÃ© avec succÃ¨s');
                });
                
                console.log('Nombre d\'Ã©lÃ©ments dans le DOM:', carouselItemsContainer.children.length);
            }
            
            // RÃ©initialiser le formulaire
            function resetForm() {
                mediaTypeSelect.value = 'image';
                mediaPreview.innerHTML = '';
                youtubeUrl.value = '';
                mediaTitle.value = '';
                mediaDescription.value = '';
                mediaLink.value = '';
                linkText.value = 'Voir plus';
                imageUploadSection.style.display = 'block';
                youtubeSection.style.display = 'none';
                // RÃ©initialiser l'input de fichier
                if (mediaUpload) {
                    mediaUpload.value = '';
                }
            }
            
            // Éditer un élément du carrousel
            function editCarouselItem(id) {
                try {
                    const item = carouselItems.find(item => item.id === id);
                    if (!item) {
                        console.error('Ã‰lÃ©ment non trouvÃ© avec l\'ID:', id);
                        return;
                    }
                    
                    currentEditId = id;
                    
                    // Remplir le formulaire avec les donnÃ©es de l'Ã©lÃ©ment
                    if (mediaTypeSelect) {
                        mediaTypeSelect.value = item.type;
                        
                        // Afficher la section appropriÃ©e selon le type de mÃ©dia
                        if (item.type === 'image') {
                            imageUploadSection.style.display = 'block';
                            youtubeSection.style.display = 'none';
                            
                            // Afficher un aperÃ§u de l'image existante
                            if (mediaPreview) {
                                mediaPreview.innerHTML = `
                                    <div class="media-preview-container" style="position: relative; display: inline-block; margin-top: 10px;">
                                        <img src="${item.url}" alt="AperÃ§u" style="max-width: 100%; max-height: 200px; display: block; border-radius: 4px;">
                                        <div style="font-size: 12px; color: #666; margin-top: 5px; text-align: center;">
                                            Image existante
                                        </div>
                                    </div>
                                `;
                            }
                        } else {
                            // Pour les vidÃ©os YouTube
                            imageUploadSection.style.display = 'none';
                            youtubeSection.style.display = 'block';
                            if (youtubeUrl) {
                                const videoId = item.url.split('/').pop();
                                youtubeUrl.value = `https://www.youtube.com/watch?v=${videoId}`;
                            }
                        }
                    }
                    
                    // Remplir les champs du formulaire
                    if (mediaTitle) mediaTitle.value = item.title || '';
                    if (mediaDescription) mediaDescription.value = item.description || '';
                    if (mediaLink) mediaLink.value = item.link || '';
                    if (linkText) linkText.value = item.linkText || 'Voir plus';
                    
                    // Mettre Ã  jour le bouton d'ajout
                    if (addMediaBtn) {
                        addMediaBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                        addMediaBtn.disabled = false;
                    }
                    
                    // Faire dÃ©filer vers le formulaire
                    const formHeader = document.querySelector('#accueil .admin-card h3');
                    if (formHeader) {
                        formHeader.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    console.log('Ã‰dition de l\'Ã©lÃ©ment:', item);
                } catch (error) {
                    console.error('Erreur lors de l\'Ã©dition de l\'Ã©lÃ©ment:', error);
                    alert('Une erreur est survenue lors du chargement de l\'Ã©lÃ©ment Ã  Ã©diter.');
                }
            }
            
            // Supprimer un élément du carrousel
            function deleteCarouselItem(id) {
                if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©lÃ©ment du carrousel ?')) {
                    const index = carouselItems.findIndex(item => item.id === id);
                    if (index !== -1) {
                        carouselItems.splice(index, 1);
                        saveCarousel();
                        updateCarouselDisplay();
                    }
                }
            }
            
            // Enregistrer le carrousel dans le stockage local
            function saveCarousel() {
                localStorage.setItem('franchiniCarousel', JSON.stringify(carouselItems));
            }
            
            // Gestion du glisser-déposer pour le réordonnancement
            let draggedItem = null;
            
            function handleDragStart(e) {
                draggedItem = this;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleDrop(e) {
                e.stopPropagation();
                this.classList.remove('drag-over');
                
                if (draggedItem !== this) {
                    // Ã‰changer les positions dans le tableau
                    const fromId = parseInt(draggedItem.dataset.id);
                    const toId = parseInt(this.dataset.id);
                    
                    const fromIndex = carouselItems.findIndex(item => item.id === fromId);
                    const toIndex = carouselItems.findIndex(item => item.id === toId);
                    
                    if (fromIndex !== -1 && toIndex !== -1) {
                        // Mettre Ã  jour l'ordre
                        const [movedItem] = carouselItems.splice(fromIndex, 1);
                        carouselItems.splice(toIndex, 0, movedItem);
                        
                        // Mettre Ã  jour les ordres
                        carouselItems.forEach((item, index) => {
                            item.order = index;
                        });
                        
                        saveCarousel();
                        updateCarouselDisplay();
                    }
                }
                
                return false;
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
                document.querySelectorAll('.carousel-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
            }
            
            // Fonction d'initialisation
            function initCarousel() {
                console.log('Initialisation du carrousel...');
                console.log('Conteneur carouselItemsContainer:', carouselItemsContainer);
                console.log('Contenu du localStorage (franchiniCarousel):', localStorage.getItem('franchiniCarousel'));
                console.log('Nombre d\'Ã©lÃ©ments chargÃ©s:', carouselItems.length);
                console.log('DÃ©tail des Ã©lÃ©ments:', JSON.stringify(carouselItems, null, 2));
                
                if (carouselItemsContainer) {
                    console.log('Mise Ã  jour de l\'affichage du carrousel...');
                    updateCarouselDisplay();
                    
                    // Ajouter les gestionnaires d'Ã©vÃ©nements pour le glisser-dÃ©poser
                    carouselItemsContainer.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        this.classList.add('drag-over-container');
                    });
                    
                    carouselItemsContainer.addEventListener('dragleave', function(e) {
                        e.preventDefault();
                        this.classList.remove('drag-over-container');
                    });
                    
                    carouselItemsContainer.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.classList.remove('drag-over-container');
                    });
                } else {
                    console.error('Erreur: carouselItemsContainer non trouvÃ©');
                }
            }
            
            // Attendre que le DOM soit complÃ¨tement chargÃ©
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initCarousel);
            } else {
                initCarousel();
            }
            
            // Initialisation des donnÃ©es pour les autres onglets
            updateMaterielsTable();
            updateActualitesTable();
            updatePromosTable();
            updateContactsTable();

            // Gestion des actualitÃ©s
            const addActualiteBtn = document.getElementById('add-actualite-btn');

            if (addActualiteBtn) {
                addActualiteBtn.addEventListener('click', function() {
                    const titre = document.getElementById('actualite-titre').value;
                    const contenu = document.getElementById('actualite-contenu').value;
                    const date = document.getElementById('actualite-date').value;

                    if (titre && contenu && date) {
                        const actualite = { 
                            id: currentActualiteEditId || Date.now(), 
                            titre, 
                            contenu, 
                            date 
                        };
                        if (currentActualiteEditId) {
                            const index = actualites.findIndex(a => a.id === currentActualiteEditId);
                            if (index !== -1) actualites[index] = actualite;
                        } else {
                            actualites.push(actualite);
                        }
                        localStorage.setItem('franchiniActualites', JSON.stringify(actualites));
                        updateActualitesTable();
                        resetActualiteForm();
                    } else {
                        alert('Veuillez remplir tous les champs pour l\'actualitÃ©.');
                    }
                });
            }

            function updateActualitesTable() {
                if (!actualitesTableBody) return;
                actualitesTableBody.innerHTML = '';
                actualites.sort((a, b) => new Date(b.date) - new Date(a.date)); // Trier par date dÃ©croissante
                actualites.forEach(actualite => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${actualite.titre}</td>
                        <td>${formatDate(actualite.date)}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit" title="Modifier" data-id="${actualite.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete" title="Supprimer" data-id="${actualite.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    `;
                    actualitesTableBody.appendChild(tr);
                });
                document.querySelectorAll('#actualites-table-body .action-btn.edit').forEach(btn => btn.addEventListener('click', e => editActualite(parseInt(e.currentTarget.dataset.id))));
                document.querySelectorAll('#actualites-table-body .action-btn.delete').forEach(btn => btn.addEventListener('click', e => deleteActualite(parseInt(e.currentTarget.dataset.id))));
            }

            function resetActualiteForm() {
                document.getElementById('actualite-form').reset();
                addActualiteBtn.innerHTML = '<i class="fas fa-plus"></i> Ajouter l\'actualitÃ©';
                currentActualiteEditId = null;
            }

            function editActualite(id) {
                const actualite = actualites.find(a => a.id === id);
                if (!actualite) return;
                currentActualiteEditId = id;
                document.getElementById('actualite-titre').value = actualite.titre;
                document.getElementById('actualite-contenu').value = actualite.contenu;
                document.getElementById('actualite-date').value = actualite.date; // HTML date input expects YYYY-MM-DD
                addActualiteBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer les modifications';
                document.querySelector('#actualites .admin-card h3').scrollIntoView({ behavior: 'smooth' });
            }

            function deleteActualite(id) {
                if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cette actualitÃ© ?')) {
                    const index = actualites.findIndex(a => a.id === id);
                    if (index !== -1) {
                        actualites.splice(index, 1);
                        localStorage.setItem('franchiniActualites', JSON.stringify(actualites));
                        updateActualitesTable();
                    }
                }
            }

            function setupDropzone(dropzoneId, inputId, previewId) {
                const dropzone = document.getElementById(dropzoneId);
                const input = document.getElementById(inputId);
                const preview = document.getElementById(previewId);
                
                if (dropzone && input && preview) {
                    dropzone.addEventListener('click', () => input.click());
                    dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
                    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
                    dropzone.addEventListener('drop', e => {
                        e.preventDefault();
                        dropzone.classList.remove('dragover');
                        if (e.dataTransfer.files.length > 0) {
                            input.files = e.dataTransfer.files;
                            handleFiles(input.files, preview);
                        }
                    });
                    input.addEventListener('change', () => handleFiles(input.files, preview));
                }
            }

            function handleFiles(files, preview) {
                if (!preview || !files || files.length === 0) return;
                
                preview.innerHTML = '';
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file && file.type && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const thumbnail = document.createElement('div');
                            thumbnail.className = 'thumbnail';
                            thumbnail.innerHTML = `<img src="${e.target.result}" alt="AperÃ§u" style="max-width: 100%; max-height: 200px;"><div class="thumbnail-name">${file.name}</div>`;
                            preview.appendChild(thumbnail);
                        };
                        reader.readAsDataURL(file);
                    } else if (preview) {
                        preview.innerHTML = '<p>Format de fichier non supportÃ©. Veuillez utiliser une image.</p>';
                    }
                }
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${day}/${month}/${year} ${hours}:${minutes}`;
            }

            // Gestion du formulaire du carrousel
            const carouselForm = document.getElementById('carousel-form');
            if (carouselForm) {
                carouselForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveCarouselItem();
                });

                // Gestion du changement de type de contenu
                const carouselType = document.getElementById('carousel-type');
                if (carouselType) {
                    carouselType.addEventListener('change', function() {
                        updateCarouselFormFields(this.value);
                    });
                }

            }

            // Mettre à jour les champs du formulaire en fonction du type de contenu
            function updateCarouselFormFields(type) {
                document.getElementById('image-upload-group').style.display = type === 'image' ? 'block' : 'none';
                document.getElementById('video-upload-group').style.display = type === 'video' ? 'block' : 'none';
                document.getElementById('youtube-url-group').style.display = type === 'youtube' ? 'block' : 'none';
            }

            // Sauvegarder un élément du carrousel
            function saveCarouselItem() {
                const type = document.getElementById('carousel-type').value;
                const title = document.getElementById('carousel-title').value;
                const description = document.getElementById('carousel-description').value;
                const startDate = document.getElementById('carousel-start-date').value;
                const endDate = document.getElementById('carousel-end-date').value;
                const link = document.getElementById('carousel-link').value;
                let mediaUrl = '';

                // RÃ©cupÃ©rer l'URL du mÃ©dia en fonction du type
                if (type === 'youtube') {
                    const youtubeUrl = document.getElementById('youtube-url').value;
                    const youtubeId = extractYoutubeId(youtubeUrl);
                    if (!youtubeId) {
                        alert('Veuillez entrer une URL YouTube valide');
                        return;
                    }
                    mediaUrl = `https://www.youtube.com/embed/${youtubeId}`;
                } else if (type === 'image') {
                    const preview = document.getElementById('carousel-preview');
                    const img = preview.querySelector('img');
                    if (!img) {
                        alert('Veuvez ajouter une image');
                        return;
                    }
                    mediaUrl = img.src; // URL de l'image en base64
                } else if (type === 'video') {
                    const preview = document.getElementById('video-preview');
                    const video = preview.querySelector('video');
                    if (!video) {
                        alert('Veuvez ajouter une vidÃ©o');
                        return;
                    }
                    mediaUrl = video.querySelector('source').src; // URL de la vidÃ©o en base64
                }

                // CrÃ©er l'objet carouselItem
                const carouselItem = {
                    id: currentCarouselEditId || Date.now(),
                    type,
                    mediaUrl,
                    title,
                    description,
                    startDate,
                    endDate,
                    link,
                    order: currentCarouselEditId ? 
                        carouselItems.find(item => item.id === currentCarouselEditId)?.order || carouselItems.length : 
                        carouselItems.length,
                    createdAt: currentCarouselEditId ? 
                        carouselItems.find(item => item.id === currentCarouselEditId)?.createdAt || new Date().toISOString() : 
                        new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Mettre Ã  jour ou ajouter l'Ã©lÃ©ment
                if (currentCarouselEditId) {
                    const index = carouselItems.findIndex(item => item.id === currentCarouselEditId);
                    if (index !== -1) {
                        carouselItems[index] = carouselItem;
                    }
                } else {
                    carouselItems.push(carouselItem);
                }

                // Sauvegarder et mettre Ã  jour l'affichage
                saveCarousel();
                updateCarouselDisplay();
                resetCarouselForm();
                currentCarouselEditId = null;
            }


            // Mettre Ã  jour l'affichage du carrousel
            function updateCarouselDisplay() {
                const container = document.getElementById('carousel-items-container');
                if (!container) return;

                // Trier les Ã©lÃ©ments par ordre
                carouselItems.sort((a, b) => a.order - b.order);

                // Vider le conteneur
                container.innerHTML = '';

                if (carouselItems.length === 0) {
                    container.innerHTML = '<p class="no-items">Aucun Ã©lÃ©ment dans le carrousel</p>';
                    return;
                }


                // Ajouter chaque Ã©lÃ©ment au conteneur
                carouselItems.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'carousel-item';
                    itemElement.draggable = true;
                    itemElement.dataset.id = item.id;
                    
                    // CrÃ©er le contenu de l'Ã©lÃ©ment
                    let mediaContent = '';
                    if (item.type === 'youtube') {
                        const youtubeId = extractYoutubeId(item.mediaUrl);
                        mediaContent = `
                            <div class="carousel-media youtube-preview">
                                <img src="https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg" 
                                     alt="VidÃ©o YouTube"
                                     onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">
                                <div class="play-icon"><i class="fas fa-play"></i></div>
                            </div>`;
                    } else if (item.type === 'image') {
                        mediaContent = `
                            <div class="carousel-media">
                                <img src="${item.mediaUrl}" 
                                     alt="${item.title || 'Image'}"
                                     onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">
                            </div>`;
                    } else if (item.type === 'video') {
                        mediaContent = `
                            <div class="carousel-media">
                                <video controls>
                                    <source src="${item.mediaUrl}" type="video/mp4">
                                    Votre navigateur ne supporte pas la lecture de vidÃ©os.
                                </video>
                            </div>`;
                    }

                    // CrÃ©er les dates formatÃ©es
                    const startDate = item.startDate ? new Date(item.startDate).toLocaleString('fr-FR') : 'Non dÃ©fini';
                    const endDate = item.endDate ? new Date(item.endDate).toLocaleString('fr-FR') : 'Non dÃ©fini';

                    // Construire le HTML de l'Ã©lÃ©ment
                    itemElement.innerHTML = `
                        <div class="carousel-item-header">
                            <div class="carousel-item-drag">
                                <i class="fas fa-grip-vertical"></i>
                            </div>
                            <div class="carousel-item-title">${item.title || 'Sans titre'}</div>
                            <div class="carousel-item-actions">
                                <button class="btn btn-edit" onclick="editCarouselItem(${item.id})">
                                    <i class="fas fa-edit"></i> Modifier
                                </button>
                                <button class="btn btn-delete" onclick="deleteCarouselItem(${item.id})">
                                    <i class="fas fa-trash"></i> Supprimer
                                </button>
                            </div>
                        </div>
                        <div class="carousel-item-content">
                            ${mediaContent}
                            <div class="carousel-item-details">
                                ${item.description ? `<p class="carousel-item-description">${item.description}</p>` : ''}
                                <div class="carousel-item-dates">
                                    <div><strong>DÃ©but :</strong> ${startDate}</div>
                                    <div><strong>Fin :</strong> ${endDate}</div>
                                </div>
                                ${item.link ? `<div class="carousel-item-link"><a href="${item.link}" target="_blank">${item.link}</a></div>` : ''}
                            </div>
                        </div>`;

                    container.appendChild(itemElement);
                });

                // Ajouter les Ã©couteurs d'Ã©vÃ©nements pour le glisser-dÃ©poser
                setupDragAndDrop();
            }

            // Réinitialiser le formulaire du carrousel
            function resetCarouselForm() {
                document.getElementById('carousel-form').reset();
                document.getElementById('carousel-item-id').value = '';
                document.getElementById('carousel-preview').innerHTML = '';
                document.getElementById('video-preview').innerHTML = '';
                document.getElementById('youtube-preview').innerHTML = '';
                document.getElementById('youtube-url').value = '';
                document.getElementById('carousel-type').value = 'image';
                updateCarouselFormFields('image');
                document.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Enregistrer';
                currentCarouselEditId = null;
            }

            // Configurer le glisser-déposer pour le réordonnancement
            function setupDragAndDrop() {
                const items = document.querySelectorAll('.carousel-item');
                
                items.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragend', handleDragEnd);
                });
            }

            function handleDragStart(e) {
                draggedItem = this;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }

            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }

            function handleDrop(e) {
                e.stopPropagation();
                e.preventDefault();
                
                if (draggedItem !== this) {
                    // Ã‰changer les Ã©lÃ©ments dans le DOM
                    const container = this.parentNode;
                    const items = Array.from(container.querySelectorAll('.carousel-item'));
                    const draggedIndex = items.indexOf(draggedItem);
                    const targetIndex = items.indexOf(this);
                    
                    if (draggedIndex < targetIndex) {
                        container.insertBefore(draggedItem, this.nextSibling);
                    } else {
                        container.insertBefore(draggedItem, this);
                    }

                    // Mettre Ã  jour l'ordre dans le tableau carouselItems
                    const newItems = Array.from(container.querySelectorAll('.carousel-item'));
                    newItems.forEach((item, index) => {
                        const itemId = parseInt(item.dataset.id);
                        const carouselItem = carouselItems.find(ci => ci.id === itemId);
                        if (carouselItem) {
                            carouselItem.order = index;
                        }
                    });

                    // Sauvegarder le nouvel ordre
                    saveCarousel();
                }
                
                this.classList.remove('drag-over');
            }

            function handleDragEnd() {
                this.classList.remove('dragging');
                document.querySelectorAll('.carousel-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
            }

            // Fonction pour éditer un élément du carrousel
            function editCarouselItem(id) {
                const item = carouselItems.find(item => item.id === id);
                if (!item) return;

                // Remplir le formulaire avec les donnÃ©es de l'Ã©lÃ©ment
                document.getElementById('carousel-type').value = item.type;
                document.getElementById('carousel-title').value = item.title || '';
                document.getElementById('carousel-description').value = item.description || '';
                document.getElementById('carousel-start-date').value = item.startDate ? item.startDate.substring(0, 16) : '';
                document.getElementById('carousel-end-date').value = item.endDate ? item.endDate.substring(0, 16) : '';
                document.getElementById('carousel-link').value = item.link || '';
                
                // Mettre Ã  jour l'affichage des champs en fonction du type
                updateCarouselFormFields(item.type);
                
                // Afficher la prÃ©visualisation du mÃ©dia
                const previewContainer = item.type === 'video' ? 
                    document.getElementById('video-preview') : 
                    document.getElementById('carousel-preview');
                
                if (item.type === 'youtube') {
                    const youtubeId = extractYoutubeId(item.mediaUrl);
                    document.getElementById('youtube-url').value = `https://www.youtube.com/watch?v=${youtubeId}`;
                    document.getElementById('youtube-preview').innerHTML = `
                        <div class="youtube-preview">
                            <img src="https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg" 
                                 alt="VidÃ©o YouTube"
                                 onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">
                            <div class="play-icon"><i class="fas fa-play"></i></div>
                        </div>`;
                } else if (item.type === 'image') {
                    previewContainer.innerHTML = `
                        <div class="thumbnail">
                            <img src="${item.mediaUrl}" 
                                 alt="AperÃ§u" 
                                 style="max-width: 100%; max-height: 200px;"
                                 onerror="this.onerror=null; this.src='../assets/images/logo/Logo Franchini 2.jpg'; this.classList.add('image-fallback')">
                        </div>`;
                } else if (item.type === 'video') {
                    previewContainer.innerHTML = `
                        <div class="thumbnail">
                            <video controls style="max-width: 100%; max-height: 200px;">
                                <source src="${item.mediaUrl}" type="video/mp4">
                                Votre navigateur ne supporte pas la lecture de vidÃ©os.
                            </video>
                        </div>`;
                }
                
                // Mettre Ã  jour le bouton de soumission
                document.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Mettre Ã  jour';
                
                // Faire dÃ©filer jusqu'au formulaire
                document.getElementById('carousel-form').scrollIntoView({ behavior: 'smooth' });
                
                // Enregistrer l'ID de l'Ã©lÃ©ment en cours d'Ã©dition
                currentCarouselEditId = id;
            }

            // Fonction pour supprimer un élément du carrousel
            function deleteCarouselItem(id) {
                if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©lÃ©ment du carrousel ?')) {
                    carouselItems = carouselItems.filter(item => item.id !== id);
                    saveCarousel();
                    updateCarouselDisplay();
                }
            }

            // Sauvegarder le carrousel dans le stockage local
            function saveCarousel() {
                localStorage.setItem('franchiniCarousel', JSON.stringify(carouselItems));
            }

            // Fonction pour initialiser le carrousel
            function initializeCarousel() {
                console.log('Initialisation du carrousel...');
                if (document.getElementById('carousel-items')) {
                    console.log('Conteneur du carrousel trouvÃ©, mise Ã  jour de l\'affichage');
                    updateCarouselDisplay();
                } else {
                    console.error('Erreur: Le conteneur du carrousel avec l\'ID "carousel-items" n\'a pas Ã©tÃ© trouvÃ©');
                }
            }

            // Gestionnaire d'événements pour les onglets
            document.querySelectorAll('.tab-btn').forEach(tabBtn => {
                tabBtn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    if (!tabId) return;
                    
                    // Masquer tous les contenus d'onglets
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // DÃ©sactiver tous les boutons d'onglets
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Activer l'onglet cliquÃ©
                    this.classList.add('active');
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) {
                        tabContent.classList.add('active');
                        
                        // Si c'est l'onglet d'accueil, initialiser le carrousel
                        if (tabId === 'accueil') {
                            initializeCarousel();
                        }
                    }
                });
            });
            
            // Initialiser le carrousel au chargement de la page si l'onglet d'accueil est actif
            if (document.querySelector('.tab-btn.active[data-tab="accueil"]')) {
                initializeCarousel();
            }
        }); // Fin de l'Ã©couteur d'Ã©vÃ©nement DOMContentLoaded
    </script>
    
    <!-- Chargement du pied de page -->
    <footer style="background-color: #1a1a1a; color: white; text-align: center; padding: 30px 0; margin-top: 40px;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 15px;">
            <div style="margin-bottom: 10px;">
                <span style="color: #4CAF50; font-weight: bold; font-size: 24px; letter-spacing: 1px;">FRANCHINI</span>
            </div>
            <div style="margin-bottom: 8px; color: #ddd;">111 av des monts du matin</div>
            <div style="margin-bottom: 15px; color: #ddd;">26300 Marches</div>
            <div style="margin-bottom: 20px;">
                <a href="tel:0475474037" style="color: white; text-decoration: none; font-size: 18px; font-weight: 500;">
                    <i class="fas fa-phone" style="margin-right: 8px;"></i>04 75 47 40 37
                </a>
            </div>
        </div>
    </main>
</div>

{% include footer.html %}

<!-- Scripts spÃcifiques Ã  l'administration -->
<script src="{{ '/assets/js/admin.js' | relative_url }}"></script>

</body>
</html>
