# Activer le moteur de réécriture
RewriteEngine On

# Définir le répertoire de base
RewriteBase /

# Forcer HTTPS (décommenter en production)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Rediriger www vers non-www (ou l'inverse selon votre préférence)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Rediriger les URL avec .html vers des URLs propres
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.*)$ $1.html [L]

# Rediriger index.html vers la racine
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /index\.html\ HTTP/
RewriteRule ^index\.html$ / [R=301,L]

# Gestion des erreurs personnalisées
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Désactiver l'accès aux dossiers
Options -Indexes

# Protéger les fichiers sensibles
<FilesMatch "^\.">
  Order allow,deny
  Deny from all
</FilesMatch>

<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak|sql|env|json|lock|md|gitignore|gitattributes|editorconfig|eslintrc|prettierrc|stylelintrc|babelrc|nvmrc|npmrc|yarnrc|travis.yml|appveyor.yml|php|phar|phtml|shtml|asp|aspx|cgi|dll|exe|pl|py|rb|sh|swf)$">
  Order allow,deny
  Deny from all
</FilesMatch>

# Protéger contre les injections de base
<IfModule mod_rewrite.c>
  RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
  RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
  RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
  RewriteRule ^(.*)$ index.html [F,L]
</IfModule>

# Protéger contre les injections de chemins
<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_URI} (\r\n|\r|\n|%0A|%0D|%0a|%0d) [NC,OR]
  RewriteCond %{REQUEST_URI} \.\./ [NC,OR]
  RewriteCond %{REQUEST_URI} ^(.*)(\r\n|\r|\n|%0A|%0D|%0a|%0d) [NC]
  RewriteRule ^(.*)$ index.html [F,L]
</IfModule>

# Protéger contre les injections de code malveillant
<IfModule mod_rewrite.c>
  RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
  RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
  RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
  RewriteRule ^(.*)$ index.html [F,L]
</IfModule>

# Désactiver le suivi des liens symboliques
Options +FollowSymLinks -SymLinksIfOwnerMatch

# Désactiver le listage des répertoires
Options -Indexes

# Protéger contre le hotlinking d'images
<IfModule mod_rewrite.c>
  RewriteCond %{HTTP_REFERER} !^$
  RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?votresite\.com [NC]
  RewriteRule \.(jpg|jpeg|png|gif|svg)$ - [NC,F,L]
</IfModule>

# Configurer les en-têtes de sécurité
<IfModule mod_headers.c>
  # Protéger contre les attaques XSS
  Header set X-XSS-Protection "1; mode=block"
  
  # Protéger contre le clickjacking
  Header always append X-Frame-Options SAMEORIGIN
  
  # Protéger contre le type MIME sniffing
  Header set X-Content-Type-Options nosniff
  
  # Politique de sécurité du contenu (CSP)
  # À personnaliser selon vos besoins
  # Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:;"
  
  # HSTS (Strict-Transport-Security)
  # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  
  # Référent Policy
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Désactiver l'affichage des informations du serveur
  ServerSignature Off
</IfModule>

# Compression GZIP
<IfModule mod_deflate.c>
  # Activer la compression pour les types de fichiers spécifiés
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/x-httpd-php
  AddOutputFilterByType DEFLATE application/x-httpd-fastphp
  AddOutputFilterByType DEFLATE application/json
  
  # Désactiver la compression pour les navigateurs bogués
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
  
  # Désactiver la compression pour les fichiers déjà compressés
  SetEnvIfNoCase Request_URI \\.(?:gif|jpe?g|png|zip|gz|rar|bz2|swf|flv|mp[34]|avi|mov|wmv|asf|asx|mpeg|mpg|mpe)$ no-gzip dont-vary
  
  # Définir le niveau de compression (1-9)
  DeflateCompressionLevel 6
  
  # Définir la taille minimale pour la compression
  DeflateMemLevel 9
  DeflateWindowSize 15
  
  # Ajouter un en-tête Vary: Accept-Encoding
  <IfModule mod_headers.c>
    Header append Vary: Accept-Encoding
  </IfModule>
</IfModule>

# Mise en cache des fichiers statiques
<IfModule mod_expires.c>
  # Activer le module d'expiration
  ExpiresActive On
  
  # Par défaut, mettre en cache pour 1 an
  ExpiresDefault "access plus 1 year"
  
  # HTML
  ExpiresByType text/html "access plus 1 hour"
  
  # Données
  ExpiresByType text/xml "access plus 0 seconds"
  ExpiresByType text/csv "access plus 0 seconds"
  ExpiresByType application/json "access plus 0 seconds"
  ExpiresByType application/ld+json "access plus 0 seconds"
  ExpiresByType application/xml "access plus 0 seconds"
  ExpiresByType application/rdf+xml "access plus 0 seconds"
  ExpiresByType application/rss+xml "access plus 1 hour"
  ExpiresByType application/atom+xml "access plus 1 hour"
  
  # Favicon (ne peut pas être renommé !)
  ExpiresByType image/x-icon "access plus 1 week"
  
  # Media : images, vidéo, audio
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/jpg "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType image/svg+xml "access plus 1 month"
  ExpiresByType image/x-icon "access plus 1 month"
  ExpiresByType video/ogg "access plus 1 month"
  ExpiresByType audio/ogg "access plus 1 month"
  ExpiresByType video/mp4 "access plus 1 month"
  ExpiresByType video/webm "access plus 1 month"
  
  # Polices
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
  
  # CSS, JavaScript
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType text/javascript "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  
  # Autres
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresByType application/x-shockwave-flash "access plus 1 month"
  
  # Désactiver la mise en cache pour les fichiers dynamiques
  <FilesMatch "\.(pl|php|cgi|spl|scgi|fcgi|html|htm)$">
    ExpiresActive Off
  </FilesMatch>
</IfModule>

# Désactiver l'accès aux fichiers .htaccess
<Files .htaccess>
  Order allow,deny
  Deny from all
</Files>

# Désactiver l'accès aux fichiers de configuration
<FilesMatch "^(wp-config\.php|wp-config-sample\.php|wp-settings\.php|wp-cron\.php|xmlrpc\.php|readme\.html|license\.txt|install\.php|web\.config|php\.ini|\.htaccess|\.htpasswd|error_log|error\.log|debug\.log|access\.log|error\.log\..*|\.svn|_vti.*|.*\.inc\.php|.*\.dist|.*\.bak|.*\.swp|.*~|.*\.swo|.*\.orig|.*\.rej|.*\.DS_Store|.*\.git|.*\.gitignore|.*\.gitmodules|.*\.gitattributes|.*\.editorconfig|.*\.jshintrc|.*\.jscsrc|.*\.eslintrc|.*\.babelrc|.*\.bowerrc|.*\.travis\.yml|.*\.codeclimate\.yml|.*\.codeclimate|.*\.codeclimate\.json|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.codeclimate\.yml\.swo|.*\.codeclimate\.yml\.swp|.*\.codeclimate\.yml~|.*\.codeclimate\.yml\.swn|.*\.code">
  Order allow,deny
  Deny from all
</FilesMatch>
